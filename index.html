<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–∑ –ö–∏—Ç–∞—è —Å –ª—é–±–æ–≤—å—é üá®üá≥ - –°–∏—Å—Ç–µ–º–∞ –∑–∞–∫–∞–∑–æ–≤</title>
    <link rel="icon" type="image/jpeg" href="https://i.ibb.co/7dr90zXz/photo-2025-12-06-23-12-26.jpg">
    <!-- TailwindCSS via browser CDN (safe for production prototype) -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .hidden { display: none; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal.hidden { display: none !important; }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 900px;
            max-height: 85vh;
            overflow-y: auto;
            margin: 1rem;
            width: 95%;
        }
        .toast-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .toast {
            min-width: 240px;
            max-width: 320px;
            padding: 0.9rem 1.1rem;
            border-radius: 1rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            box-shadow: 0 10px 25px rgba(15,23,42,0.2);
            animation: slide-in 0.3s ease, fade-out 0.4s ease 4.6s forwards;
            font-size: 0.95rem;
        }
        .toast-success { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .toast-error { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .toast-info { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .toast-warning { background: linear-gradient(135deg, #f97316, #ea580c); }
        @keyframes slide-in {
            from { transform: translateX(120%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fade-out {
            to { opacity: 0; transform: translateX(120%); }
        }

        /* Responsive tweaks */
        @media (max-width: 1024px) {
            .lg\:grid-cols-3 { grid-template-columns: 1fr !important; }
            .lg\:grid-cols-2 { grid-template-columns: 1fr !important; }
            .lg\:col-span-2 { grid-column: span 1 / span 1 !important; }
            .admin-actions { flex-direction: column; align-items: stretch; gap: 0.5rem; }
        }
        @media (max-width: 768px) {
            body { padding: 12px !important; }
            .max-w-6xl { padding-left: 0; padding-right: 0; }
            .modal-content { width: 100%; max-height: 88vh; padding: 1.25rem; }
            .order-card-grid { grid-template-columns: 1fr !important; }
            .stack-sm { flex-direction: column; align-items: flex-start; gap: 0.75rem; }
            .w-full-mobile { width: 100%; }
        }
        @media (max-width: 480px) {
            .modal-content { padding: 1rem; }
            .p-6 { padding: 1.25rem !important; }
            .p-8 { padding: 1.5rem !important; }
            h1, .text-3xl { font-size: 1.6rem !important; }
            h2, .text-2xl { font-size: 1.3rem !important; }
        }
        /* Extra polish for phones (iOS/Android) */
        @media (max-width: 640px) {
            body { padding: 10px !important; }
            .modal-content { max-height: 88vh; border-radius: 1.5rem; }
            .max-w-6xl { padding-left: 0; padding-right: 0; }
            .grid { gap: 1rem; }
            .flex { gap: 0.75rem; }
            .btn-full-mobile { width: 100% !important; }
            .stack-mobile, .admin-actions { flex-direction: column !important; align-items: stretch !important; }
            .order-card-grid { grid-template-columns: 1fr !important; }
            .text-balance { text-wrap: balance; }
            input, select, textarea, button { font-size: 16px !important; } /* —É–±–∏—Ä–∞–µ—Ç –∑—É–º –Ω–∞ iOS */
        }

        /* =============================
           Client UI polish
        ==============================*/
        .client-form-card,
        .client-orders-card {
            position: relative;
            overflow: hidden;
        }
        .client-form-card::before,
        .client-orders-card::before {
            content: '';
            position: absolute;
            inset: -40%;
            background: radial-gradient(circle at 30% 30%, rgba(99,102,241,0.08), transparent 45%),
                        radial-gradient(circle at 80% 10%, rgba(236,72,153,0.08), transparent 35%),
                        radial-gradient(circle at 60% 70%, rgba(99,102,241,0.06), transparent 30%);
            z-index: 0;
        }
        .client-form-card > *,
        .client-orders-card > * { position: relative; z-index: 1; }
        .client-order-card {
            border: 1px solid rgba(148,163,184,0.25);
            background: linear-gradient(180deg, #fff 0%, #f8fafc 100%);
            box-shadow: 0 20px 45px rgba(79,70,229,0.08);
            transition: transform .2s ease, box-shadow .2s ease;
        }
        .client-order-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 25px 60px rgba(79,70,229,0.12);
        }
        .pill-status {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.4rem 0.75rem;
            border-radius: 9999px;
            font-weight: 600;
            background: linear-gradient(135deg, #ede9fe, #eef2ff);
            color: #4338ca;
            border: 1px solid rgba(67,56,202,0.12);
        }
        .section-label {
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.01em;
            color: #475569;
        }
        .info-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.35rem 0.65rem;
            border-radius: 12px;
            font-size: 0.85rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            color: #0f172a;
        }
        .photo-grid button img { transition: transform .2s ease; }
        .photo-grid button:hover img { transform: scale(1.05); }
    </style>
</head>
<body class="p-4">
    <div id="toastContainer" class="toast-container"></div>
    <div class="max-w-6xl mx-auto">
        <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
        <div id="loginView" class="relative max-w-md mx-auto mt-12">
            <div class="absolute -inset-0.5 bg-gradient-to-r from-purple-400 via-pink-400 to-indigo-500 rounded-3xl opacity-60 blur-lg"></div>
            <div class="relative bg-white/80 backdrop-blur-xl border border-white/70 rounded-3xl shadow-2xl p-8">
                <div class="flex flex-col items-center mb-6">
                    <div class="w-20 h-20 rounded-2xl bg-gradient-to-tr from-purple-500 to-red-400 p-1 shadow-xl mb-3">
                        <img src="https://i.ibb.co/7dr90zXz/photo-2025-12-06-23-12-26.jpg" alt="–õ–æ–≥–æ—Ç–∏–ø" class="w-full h-full object-cover rounded-2xl border border-white/70">
                    </div>
                    <h1 class="text-2xl font-extrabold text-purple-800 tracking-tight text-center">üá®üá≥ –ò–∑ –ö–∏—Ç–∞—è —Å –ª—é–±–æ–≤—å—é üá®üá≥</h1>
                    <p class="mt-2 text-xs text-gray-500 text-center max-w-xs">–ó–∞–∫—Ä—ã—Ç—ã–π –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ –∏–∑ –ö–∏—Ç–∞—è.</p>
                </div>

                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                        <span class="w-8 h-8 rounded-xl bg-purple-100 text-purple-600 flex items-center justify-center text-lg">üîë</span>
                        <span>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</span>
                    </h2>
                    <span class="text-[11px] uppercase tracking-wide text-gray-400 bg-gray-50 px-2 py-1 rounded-full border">–¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤</span>
                </div>

                <form id="loginForm" class="space-y-4">
                    <div>
                        <label class="block text-xs font-semibold mb-1 text-gray-600">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 text-gray-400 text-sm">üì±</span>
                            <input type="tel" id="loginPhone" required
                                class="w-full pl-9 pr-3 py-2.5 text-sm border border-gray-200 rounded-xl bg-white focus:ring-2 focus:ring-purple-500 focus:border-purple-400 outline-none transition shadow-sm"
                                placeholder="+375 (29) ___-__-__">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold mb-1 text-gray-600">–ü–∞—Ä–æ–ª—å</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 text-gray-400 text-sm">üîí</span>
                            <input type="password" id="loginPassword" required
                                class="w-full pl-9 pr-10 py-2.5 text-sm border border-gray-200 rounded-xl bg-white focus:ring-2 focus:ring-purple-500 focus:border-purple-400 outline-none transition shadow-sm">
                        </div>
                    </div>
                    <button type="submit"
                        class="w-full mt-2 bg-gradient-to-r from-purple-600 via-fuchsia-600 to-indigo-600 text-white py-2.5 rounded-xl text-sm font-semibold shadow-lg shadow-purple-300 hover:shadow-xl hover:from-purple-700 hover:to-indigo-700 transition transform hover:-translate-y-0.5">
                        –í–æ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
                    </button>
                </form>

                <div class="mt-5 flex flex-col gap-2 text-center text-xs">
                    <button onclick="showRegister()" class="text-purple-700 font-medium hover:text-purple-900 hover:underline">
                        –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                    </button>
                    <button onclick="showAdminLogin()" class="text-gray-500 hover:text-gray-700 hover:underline">
                        –í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                    </button>
                </div>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
        <div id="registerView" class="hidden relative max-w-md mx-auto mt-16">
            <div class="absolute -inset-0.5 bg-gradient-to-r from-pink-400 via-purple-500 to-indigo-600 rounded-3xl opacity-60 blur-lg"></div>
            <div class="relative bg-white/80 backdrop-blur-xl border border-white/70 rounded-3xl shadow-2xl p-8">
                <div class="flex flex-col items-center mb-6 text-center">
                    <div class="w-20 h-20 rounded-2xl bg-gradient-to-tr from-purple-500 to-red-400 p-1 shadow-xl mb-3">
                        <img src="https://i.ibb.co/7dr90zXz/photo-2025-12-06-23-12-26.jpg" alt="–õ–æ–≥–æ—Ç–∏–ø" class="w-full h-full object-cover rounded-2xl border border-white/70">
                    </div>
                    <p class="text-[11px] uppercase tracking-[0.2em] text-purple-500 font-semibold">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</p>
                    <h1 class="text-2xl font-extrabold text-purple-800 tracking-tight">üá®üá≥ –ò–∑ –ö–∏—Ç–∞—è —Å –ª—é–±–æ–≤—å—é üá®üá≥</h1>
                    <p class="mt-2 text-xs text-gray-500 max-w-xs">–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑, –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ–∫–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã.</p>
                </div>

                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                        <span class="w-8 h-8 rounded-xl bg-purple-100 text-purple-600 flex items-center justify-center text-lg">üìù</span>
                        <span>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span>
                    </h2>
                    <span class="text-[11px] uppercase tracking-wide text-gray-400 bg-gray-50 px-2 py-1 rounded-full border">–Ω–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç</span>
                </div>

                <form id="registerForm" class="space-y-4">
                    <div>
                        <label class="block text-xs font-semibold mb-1 text-gray-600">–§–ò–û *</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 text-gray-400 text-sm">üë§</span>
                            <input type="text" id="regFullName" required
                                class="w-full pl-9 pr-3 py-2.5 text-sm border border-gray-200 rounded-xl bg-white focus:ring-2 focus:ring-purple-500 focus:border-purple-400 outline-none transition shadow-sm"
                                placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold mb-1 text-gray-600">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 text-gray-400 text-sm">üì±</span>
                            <input type="tel" id="regPhone" required
                                class="w-full pl-9 pr-3 py-2.5 text-sm border border-gray-200 rounded-xl bg-white focus:ring-2 focus:ring-purple-500 focus:border-purple-400 outline-none transition shadow-sm"
                                placeholder="+375 (29) ___-__-__">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold mb-1 text-gray-600">–ù–∏–∫ –≤ Telegram *</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 text-gray-400 text-sm">‚úàÔ∏è</span>
                            <input type="text" id="regTelegram" required
                                class="w-full pl-9 pr-3 py-2.5 text-sm border border-gray-200 rounded-xl bg-white focus:ring-2 focus:ring-purple-500 focus:border-purple-400 outline-none transition shadow-sm"
                                placeholder="@username">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold mb-1 text-gray-600">–ü–∞—Ä–æ–ª—å *</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 text-gray-400 text-sm">üîí</span>
                            <input type="password" id="regPassword" required minlength="6"
                                class="w-full pl-9 pr-10 py-2.5 text-sm border border-gray-200 rounded-xl bg-white focus:ring-2 focus:ring-purple-500 focus:border-purple-400 outline-none transition shadow-sm"
                                placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤">
                        </div>
                    </div>
                    <button type="submit"
                        class="w-full mt-2 bg-gradient-to-r from-purple-600 via-fuchsia-600 to-indigo-600 text-white py-2.5 rounded-xl text-sm font-semibold shadow-lg shadow-purple-300 hover:shadow-xl hover:from-purple-700 hover:to-indigo-700 transition transform hover:-translate-y-0.5">
                        –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                    </button>
                </form>

                <div class="mt-5 text-center text-xs flex flex-col gap-2">
                    <button onclick="showLogin()" class="text-purple-700 font-medium hover:text-purple-900 hover:underline">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏</button>
                </div>
            </div>
        </div>

        <!-- –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ -->
        <div id="clientView" class="hidden space-y-6">
            <!-- Hero -->
            <div class="relative overflow-hidden rounded-3xl bg-gradient-to-br from-purple-900 via-indigo-900 to-black text-white p-6 lg:p-8 shadow-2xl">
                <div class="absolute inset-0 opacity-20" style="background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.25), transparent 35%), radial-gradient(circle at 80% 10%, rgba(255,255,255,0.2), transparent 30%), radial-gradient(circle at 60% 70%, rgba(255,255,255,0.15), transparent 30%);"></div>
                <div class="relative flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 rounded-2xl bg-white/10 border border-white/10 flex items-center justify-center text-3xl shadow-lg">üíé</div>
                        <div>
                            <p class="text-sm text-purple-200">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å,</p>
                            <h1 class="text-3xl font-extrabold" id="clientName">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
                            <p class="text-sm text-purple-200">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∑–∞–∫–∞–∑–∞–º–∏ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫</p>
                        </div>
                    </div>
                    <button onclick="logout()" class="relative px-6 py-3 bg-white text-purple-800 rounded-2xl font-semibold shadow-xl hover:shadow-2xl transition transform hover:-translate-y-0.5">–í—ã–π—Ç–∏</button>
                </div>
            </div>

            <div class="grid lg:grid-cols-3 gap-6">
                <!-- –§–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞ -->
                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-white/80 backdrop-blur rounded-2xl shadow-2xl border border-white/40 p-6 client-form-card">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="text-2xl">üõí</span>
                            <h2 class="text-2xl font-bold text-gray-800">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑</h2>
                        </div>

                        <!-- –ü—Ä–∏—ë–º –∑–∞–∫–∞–∑–æ–≤ -->
                        <div class="bg-purple-50 p-4 rounded-xl mb-4 border border-purple-200">
                            <h3 class="font-bold text-purple-800 flex items-center gap-2 mb-2">
                                <span>üì¶</span> –ü—Ä–∏—ë–º –∑–∞–∫–∞–∑–æ–≤
                            </h3>
                            <ul class="text-sm text-purple-800 space-y-1">
                                <li>üöõ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–∫–∞–∑—ã –æ—Ç 10 –∫–≥ –º–æ–∂–Ω–æ –æ—Ñ–æ—Ä–º–ª—è—Ç—å –≤ –ª—é–±–æ–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ ‚Äî –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.</li>
                                <li>üì¶ –ú–µ–ª–∫–∏–µ –∑–∞–∫–∞–∑—ã –¥–æ 10 –∫–≥ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–Ω–∏ ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏—ë–º–∞ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ Telegram-–≥—Ä—É–ø–ø–µ.</li>
                            </ul>
                            <a href="https://t.me/from_china_with_love25" target="_blank" class="inline-block mt-3 text-sm font-bold text-purple-600 hover:underline">üëâ –ü–µ—Ä–µ–π—Ç–∏ –≤ –≥—Ä—É–ø–ø—É Telegram</a>
                        </div>

                        <!-- –°—Ä–æ–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ -->
                        <div class="bg-amber-50 p-4 rounded-xl mb-4 border border-amber-200">
                            <h3 class="font-bold text-amber-800 flex items-center gap-2 mb-2">
                                <span>‚ö†Ô∏è</span> –ü—Ä–∏–º–µ—Ä–Ω—ã–π —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ —Å –º–æ–º–µ–Ω—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ —Å–∫–ª–∞–¥–∞ –≤ –ö–∏—Ç–∞–µ: 30‚Äì45 –¥–Ω–µ–π
                            </h3>
                            <p class="text-sm text-amber-800 mb-2">–°–Ω–∞—á–∞–ª–∞ –≥—Ä—É–∑ –ø—Ä–∏–±—ã–≤–∞–µ—Ç –∏–∑ –ö–∏—Ç–∞—è –≤ –ú–æ—Å–∫–≤—É, –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç—Å—è –≤ –ë–µ–ª–∞—Ä—É—Å—å:</p>
                            <ul class="text-sm text-amber-800 space-y-1 list-disc list-inside ml-2">
                                <li>–ê–≤—Ç–æ–ª–∞–π—Ç –Ω–∞ –≤–∞—à –∞–¥—Ä–µ—Å ‚Äî –µ—Å–ª–∏ –≤–µ—Å –∑–∞–∫–∞–∑–∞ –æ—Ç 10 –∫–≥ –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.</li>
                                <li>–ï—Å–ª–∏ –≤–µ—Å –¥–æ 10 –∫–≥ ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –ï–≤—Ä–æ–ø–æ—á—Ç–æ–π –∏–ª–∏ –ë–µ–ª–ø–æ—á—Ç–æ–π –∑–∞ —Å—á—ë—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞.</li>
                            </ul>
                            <div class="mt-3 p-3 bg-amber-100 rounded-lg border border-amber-300">
                                <p class="text-xs text-amber-900"><strong>‚ö†Ô∏è –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:</strong> –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–∑–∫–µ –≤–æ–∑–º–æ–∂–Ω—ã —Ñ–æ—Ä—Å-–º–∞–∂–æ—Ä—ã –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ, –Ω–µ–±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–µ –ø–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –∏ –¥—Ä—É–≥–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ —Å—Ä–æ–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏. –¢–∞–∫–∂–µ —è –Ω–µ –Ω–µ—Å—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –ø—Ä–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ ‚Äî —ç—Ç–æ —Ä–∏—Å–∫, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—á–∏—Ç—ã–≤–∞—Ç—å.</p>
                            </div>
                        </div>

                        <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞—Ö -->
                        <div id="forbiddenItemsWarning" class="bg-red-50 p-4 rounded-xl mb-4 border border-red-200 hidden">
                            <div class="flex items-start gap-3">
                                <div class="text-xl">‚ö†Ô∏è</div>
                                <div>
                                    <h4 class="font-semibold text-red-700">–°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤</h4>
                                    <ul id="forbiddenItemsList" class="list-disc pl-5 space-y-1 text-sm text-red-700 mt-2"></ul>
                                </div>
                            </div>
                        </div>

                        <form id="orderForm" class="space-y-4">
                            <!-- –°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏ -->
                            <div>
                                <label class="block text-sm font-semibold mb-2 text-gray-700">–°–ø–æ—Å–æ–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ –†–ë *</label>
                                <div class="relative">
                                    <select id="deliveryMethod" required onchange="handleDeliveryExtras()"
                                        class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-purple-500 focus:border-purple-400 bg-gray-50 text-gray-800">
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</option>
                                    </select>
                                    <span class="absolute right-3 top-3 text-gray-400">‚¨á</span>
                                </div>
                                <div id="deliveryDetailsBlock" class="mt-3 space-y-3">
                                    <div id="europostBlock" class="hidden bg-blue-50 border border-blue-200 rounded-xl p-3">
                                        <label class="block text-sm font-medium text-blue-800 mb-1">–ê–¥—Ä–µ—Å –æ—Ç–¥–µ–ª–µ–Ω–∏—è –ï–≤—Ä–æ–ø–æ—á—Ç—ã *</label>
                                        <input type="text" id="europostBranch" class="w-full px-3 py-2 rounded-lg border border-blue-200 focus:ring-2 focus:ring-blue-400" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –Ω–æ–º–µ—Ä –æ—Ç–¥–µ–ª–µ–Ω–∏—è">
                                    </div>
                                    <div id="belpostBlock" class="hidden bg-amber-50 border border-amber-200 rounded-xl p-3 space-y-2">
                                        <p class="text-sm font-medium text-amber-800">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –ë–µ–ª–ø–æ—á—Ç–æ–π *</p>
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                            <input type="text" id="belpostIndex" class="px-3 py-2 rounded-lg border border-amber-200 focus:ring-2 focus:ring-amber-400" placeholder="–ò–Ω–¥–µ–∫—Å">
                                            <input type="text" id="belpostCity" class="px-3 py-2 rounded-lg border border-amber-200 focus:ring-2 focus:ring-amber-400" placeholder="–ù–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç">
                                            <input type="text" id="belpostStreet" class="px-3 py-2 rounded-lg border border-amber-200 focus:ring-2 focus:ring-amber-400" placeholder="–£–ª–∏—Ü–∞">
                                            <input type="text" id="belpostHouse" class="px-3 py-2 rounded-lg border border-amber-200 focus:ring-2 focus:ring-amber-400" placeholder="–î–æ–º / –∫–≤–∞—Ä—Ç–∏—Ä–∞">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –¢–æ–≤–∞—Ä—ã -->
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <label class="text-sm font-semibold text-gray-700">–¢–æ–≤–∞—Ä—ã *</label>
                                    <button type="button" onclick="addProductRow()" class="inline-flex items-center gap-2 bg-gradient-to-r from-emerald-500 to-green-600 text-white px-3 py-2 rounded-xl text-sm font-semibold shadow-lg hover:shadow-xl transition">
                                        <span>Ôºã</span> –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                                    </button>
                                </div>
                                <div id="productsContainer" class="space-y-4"></div>
                            </div>

                            <!-- –†–∞—Å—á—ë—Ç —Å—É–º–º—ã -->
                            <div class="rounded-2xl border border-purple-100 bg-gradient-to-r from-purple-50 to-indigo-50 p-4">
                                <h3 class="font-semibold text-gray-800 mb-2">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç</h3>
                                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2 text-sm">
                                    <p class="text-gray-600">–ö—É—Ä—Å —é–∞–Ω—è: <span id="displayYuanRate" class="font-bold text-gray-900">0</span> BYN</p>
                                    <div class="text-right">
                                        <p class="text-lg font-extrabold text-purple-700">–ò—Ç–æ–≥–æ: <span id="totalSum">0</span> BYN</p>
                                        <p class="text-[11px] text-gray-500">–î–æ—Å—Ç–∞–≤–∫–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è</p>
                                    </div>
                                </div>
                            </div>

                            <!-- –ß–µ–∫ –æ–ø–ª–∞—Ç—ã -->
                            <div class="rounded-2xl border border-dashed border-purple-200 p-4 bg-purple-50/60">
                                <div class="flex items-center justify-between gap-2">
                                    <div>
                                        <p class="text-sm font-semibold text-gray-800">–ß–µ–∫ –æ–ø–ª–∞—Ç—ã —Ç–æ–≤–∞—Ä–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</p>
                                        <p class="text-xs text-gray-500">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è JPG/PNG, –¥–æ 10 –ú–ë</p>
                                    </div>
                                    <span class="px-3 py-1 rounded-full bg-white text-purple-600 text-xs font-semibold border border-purple-200">–§–æ—Ç–æ —á–µ–∫–∞</span>
                                </div>
                                <label for="paymentReceipt" class="mt-3 block cursor-pointer rounded-xl border-2 border-dashed border-purple-200 bg-white/70 hover:bg-white transition p-4 text-center">
                                    <div class="flex flex-col items-center gap-1 text-sm text-gray-600">
                                        <span class="text-lg">üìÑ</span>
                                        <span class="font-semibold text-gray-800">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</span>
                                        <span class="text-xs text-gray-500">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ–∫</span>
                                    </div>
                                </label>
                                <input type="file" id="paymentReceipt" accept="image/*" class="hidden">
                                <p class="text-[11px] text-gray-500 mt-2">–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ–π—á–∞—Å –∏–ª–∏ –ø–æ–∑–∂–µ –≤ —Å–ø–∏—Å–∫–µ –∑–∞–∫–∞–∑–æ–≤</p>
                            </div>

                            <!-- –î–æ–≥–æ–≤–æ—Ä-–æ—Ñ–µ—Ä—Ç–∞ -->
                            <div class="rounded-2xl border border-yellow-200 bg-yellow-50 p-4">
                                <label class="flex items-start gap-3 text-sm text-gray-800">
                                    <input type="checkbox" id="agreeToTerms" required class="mt-1 h-4 w-4 text-purple-600">
                                    <span>–Ø –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω –∏ —Å–æ–≥–ª–∞—Å–µ–Ω —Å <button type="button" onclick="showOfferModal()" class="text-purple-600 underline hover:text-purple-800">–¥–æ–≥–æ–≤–æ—Ä–æ–º-–æ—Ñ–µ—Ä—Ç–æ–π</button></span>
                                </label>
                            </div>

                            <button type="submit" class="w-full py-4 rounded-xl bg-gradient-to-r from-purple-600 to-indigo-600 text-white text-lg font-bold shadow-xl hover:shadow-2xl transform hover:-translate-y-0.5 transition">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
                        </form>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
                    <div class="bg-white/80 backdrop-blur rounded-2xl shadow-2xl border border-white/40 p-6 client-orders-card">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
                            <div class="flex items-center gap-3 flex-wrap">
                                <div class="flex items-center gap-2">
                                    <span class="text-2xl">üì¶</span>
                                    <h2 class="text-2xl font-bold text-gray-800">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
                                </div>
                                <button id="clientPaymentDetailsBtn" type="button" class="px-4 py-2 rounded-xl bg-yellow-50 text-yellow-800 text-sm font-semibold border border-yellow-200 hover:bg-yellow-100 transition">
                                    üí≥ –†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã
                                </button>
                            </div>
                            <div class="relative w-full md:w-72">
                                <input type="text" id="searchOrder" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É (BY-01)" oninput="searchClientOrders()" class="w-full px-4 py-2.5 rounded-xl border border-gray-200 bg-gray-50 focus:ring-2 focus:ring-purple-500">
                                <span class="absolute right-3 top-2.5 text-gray-400">üîç</span>
                            </div>
                        </div>
                        <div id="clientOrders" class="space-y-4"></div>
                    </div>
                </div>

                <!-- –ò–Ω—Ñ–æ –∫–æ–ª–æ–Ω–∫–∞ -->
                <div class="space-y-4">
                    <div class="bg-white/70 backdrop-blur rounded-2xl shadow-xl border border-white/40 p-5">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-2xl">üí°</span>
                            <h3 class="text-lg font-bold text-gray-800">–ü–æ–¥—Å–∫–∞–∑–∫–∏</h3>
                        </div>
                        <ul class="text-sm text-gray-600 space-y-2 list-disc list-inside">
                            <li>–î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –æ–¥–∏–Ω –∑–∞–∫–∞–∑.</li>
                            <li>–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.</li>
                            <li>–ß–µ–∫ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è.</li>
                        </ul>
                    </div>
                    <div class="bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-2xl shadow-xl p-5">
                        <h3 class="text-lg font-bold mb-2">–°–≤—è–∑—å</h3>
                        <p class="text-sm opacity-90">–ú—ã —Å–æ–æ–±—â–∏–º –æ —Å—Ç–∞—Ç—É—Å–µ –≤ Telegram –∏ —á–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
        <div id="adminView" class="hidden">
            <!-- Header –ê–¥–º–∏–Ω–∫–∏ -->
            <div class="bg-gradient-to-r from-gray-900 to-purple-900 text-white rounded-t-2xl p-8 shadow-lg">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <div class="bg-white/10 p-3 rounded-full backdrop-blur-sm">
                            <span class="text-3xl">üõ°Ô∏è</span>
                        </div>
                        <div>
                            <h1 class="text-3xl font-bold tracking-tight">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                            <p class="text-purple-200 text-sm">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π –∑–∞–∫–∞–∑–æ–≤</p>
                        </div>
                    </div>
                    <button onclick="logout()"
                        class="bg-white/10 hover:bg-white/20 text-white px-6 py-2.5 rounded-xl transition backdrop-blur-sm border border-white/10 font-medium flex items-center space-x-2">
                        <span>–í—ã–π—Ç–∏</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    </button>
                </div>

                <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ -->
                <div class="flex space-x-2 mt-8 overflow-x-auto pb-2">
                    <button onclick="showAdminTab('orders')" id="tabOrders"
                        class="px-6 py-3 rounded-xl font-semibold transition-all duration-200 flex items-center space-x-2 bg-white text-purple-900 shadow-lg transform scale-105">
                        <span>üì¶</span><span>–ó–∞–∫–∞–∑—ã</span>
                    </button>
                    <button onclick="showAdminTab('finance')" id="tabFinance"
                        class="px-6 py-3 rounded-xl font-semibold transition-all duration-200 flex items-center space-x-2 bg-white/10 text-white hover:bg-white/20">
                        <span>üí∏</span><span>–§–∏–Ω–∞–Ω—Å—ã</span>
                    </button>
                    <button onclick="showAdminTab('users')" id="tabUsers"
                        class="px-6 py-3 rounded-xl font-semibold transition-all duration-200 flex items-center space-x-2 bg-white/10 text-white hover:bg-white/20">
                        <span>üë•</span><span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                    </button>
                    <button onclick="showAdminTab('settings')" id="tabSettings"
                        class="px-6 py-3 rounded-xl font-semibold transition-all duration-200 flex items-center space-x-2 bg-white/10 text-white hover:bg-white/20">
                        <span>‚öôÔ∏è</span><span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                    </button>
                </div>
            </div>

            <div class="bg-gray-50 rounded-b-2xl shadow-2xl min-h-[600px] p-6">
                <!-- –í–∫–ª–∞–¥–∫–∞ –∑–∞–∫–∞–∑–æ–≤ -->
                <div id="adminOrdersTab">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center mb-4 md:mb-0">
                            <span class="bg-purple-100 text-purple-700 p-2 rounded-lg mr-3">üì¶</span>
                            –í—Å–µ –∑–∞–∫–∞–∑—ã
                        </h2>
                        <div class="flex flex-col sm:flex-row gap-3 items-stretch sm:items-center">
                            <div class="flex gap-3">
                                <div class="relative">
                                    <label class="absolute -top-2 left-3 bg-white px-1 text-xs text-purple-600 font-medium">–ì–æ–¥</label>
                                    <select id="filterYear" onchange="loadAdminOrders()" class="w-32 px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none cursor-pointer hover:bg-gray-100 transition">
                                        <option value="2025" selected>2025</option>
                                        <option value="2026">2026</option>
                                        <option value="2027">2027</option>
                                        <option value="2028">2028</option>
                                        <option value="2029">2029</option>
                                        <option value="2030">2030</option>
                                        <option value="2031">2031</option>
                                        <option value="2032">2032</option>
                                        <option value="2033">2033</option>
                                        <option value="2034">2034</option>
                                        <option value="2035">2035</option>
                                        <option value="2036">2036</option>
                                        <option value="2037">2037</option>
                                        <option value="2038">2038</option>
                                        <option value="2039">2039</option>
                                        <option value="2040">2040</option>
                                        <option value="2041">2041</option>
                                        <option value="2042">2042</option>
                                        <option value="2043">2043</option>
                                        <option value="2044">2044</option>
                                        <option value="2045">2045</option>
                                        <option value="2046">2046</option>
                                        <option value="2047">2047</option>
                                        <option value="2048">2048</option>
                                        <option value="2049">2049</option>
                                        <option value="2050">2050</option>
                                        <option value="2024">2024</option>
                                        <option value="2023">2023</option>
                                    </select>
                                </div>
                                <div class="relative">
                                    <label class="absolute -top-2 left-3 bg-white px-1 text-xs text-purple-600 font-medium">–ú–µ—Å—è—Ü</label>
                                    <select id="filterMonth" onchange="loadAdminOrders()" class="w-40 px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none cursor-pointer hover:bg-gray-100 transition">
                                        <option value="all">üìÖ –í—Å–µ –º–µ—Å—è—Ü—ã</option>
                                        <option value="0">–Ø–Ω–≤–∞—Ä—å</option>
                                        <option value="1">–§–µ–≤—Ä–∞–ª—å</option>
                                        <option value="2">–ú–∞—Ä—Ç</option>
                                        <option value="3">–ê–ø—Ä–µ–ª—å</option>
                                        <option value="4">–ú–∞–π</option>
                                        <option value="5">–ò—é–Ω—å</option>
                                        <option value="6">–ò—é–ª—å</option>
                                        <option value="7">–ê–≤–≥—É—Å—Ç</option>
                                        <option value="8">–°–µ–Ω—Ç—è–±—Ä—å</option>
                                        <option value="9">–û–∫—Ç—è–±—Ä—å</option>
                                        <option value="10">–ù–æ—è–±—Ä—å</option>
                                        <option value="11">–î–µ–∫–∞–±—Ä—å</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex flex-col sm:flex-row gap-2 sm:items-center text-xs text-gray-600">
                                <label class="flex items-center gap-2">
                                    <input type="checkbox" id="filterCurrentMonth" onchange="toggleCurrentMonth()" class="h-4 w-4 text-purple-600 rounded">
                                    <span>–¢–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</span>
                                </label>
                                <label class="flex items-center gap-2">
                                    <input type="checkbox" id="sortByStatus" onchange="loadAdminOrders()" class="h-4 w-4 text-purple-600 rounded" checked>
                                    <span>–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Å—Ç–∞—Ç—É—Å—É</span>
                                </label>
                            </div>
                            <button onclick="exportSelectedOrders()" class="inline-flex items-center justify-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-semibold rounded-lg shadow-sm transition">
                                ‚¨á –≠–∫—Å–ø–æ—Ä—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≤ Excel
                            </button>
                        </div>
                    </div>
                    <div id="adminOrders" class="space-y-6"></div>
                </div>

                <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–≤–æ–¥–∞ –≤–µ—Å–∞ –∏ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–∞ -->
                <div id="weightModal" class="modal hidden">
                    <div class="modal-content">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h2 class="text-2xl font-bold">–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∫–∏</h2>
                                <p class="text-sm text-gray-600">–ó–∞–∫–∞–∑ #<span id="weightOrderId"></span></p>
                                <p class="text-xs text-purple-600 mt-1">–°—Ç–∞—Ç—É—Å: –û—Ç–ø—Ä–∞–≤–ª–µ–Ω –∏–∑ –ö–∏—Ç–∞—è</p>
                            </div>
                            <button onclick="closeWeightModal()" class="text-gray-500 hover:text-gray-800">‚úï</button>
                        </div>

                        <div class="mb-4 text-sm text-blue-800 bg-blue-50 p-3 rounded border border-blue-200">
                            <p>–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—Å (–∫–≥) –∏ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞.</p>
                        </div>

                        <div id="weightProductsContainer" class="space-y-3 mb-4 max-h-60 overflow-y-auto"></div>

                        <div class="bg-purple-50 p-4 rounded-lg mb-4 border border-purple-200">
                            <h3 class="font-semibold mb-2">–ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç:</h3>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <p>–û–±—â–∏–π –≤–µ—Å:</p>
                                <p class="font-bold"><span id="totalWeightDisplay">0</span> –∫–≥</p>
                                <p>–¶–µ–Ω–∞ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É:</p>
                                <p class="font-bold"><span id="deliveryCostCalc">0</span> BYN</p>
                                <p class="text-lg pt-2 border-t font-bold text-purple-700">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ –∫–ª–∏–µ–Ω—Ç–æ–º:</p>
                                <p class="text-lg pt-2 border-t font-bold text-purple-700"><span id="totalToPayCalc">0</span> BYN</p>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">–§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <input type="file" id="productPhotos" multiple accept="image/*" class="w-full px-4 py-2 border rounded-lg">
                            <p class="text-xs text-gray-500 mt-1">–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –ø–æ—Å—ã–ª–∫–∏ –∏–ª–∏ —Ç–æ–≤–∞—Ä–æ–≤</p>
                        </div>

                        <div class="flex space-x-2">
                            <button onclick="saveWeightData()" class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">
                                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å
                            </button>
                            <button onclick="closeWeightModal()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </div>
                </div>

                <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ -->
                <div id="editOrderModal" class="modal hidden">
                    <div class="modal-content">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h2 class="text-2xl font-bold">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
                                <p class="text-sm text-gray-600">–ó–∞–∫–∞–∑ #<span id="editOrderId"></span></p>
                            </div>
                            <button onclick="closeEditOrder()" class="text-gray-500 hover:text-gray-800">‚úï</button>
                        </div>

                        <div class="space-y-4">
                            <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                                <label class="block text-sm font-semibold mb-2">–°–ø–æ—Å–æ–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ –†–ë *</label>
                                <select id="editDeliveryMethod" class="w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-purple-500" onchange="handleEditDeliveryExtras()"></select>
                                <div id="editDeliveryDetails" class="mt-3 space-y-3">
                                    <div id="editEuropostBlock" class="hidden bg-blue-50 border border-blue-200 rounded-xl p-3">
                                        <label class="block text-sm font-medium mb-1 text-blue-800">–ê–¥—Ä–µ—Å –æ—Ç–¥–µ–ª–µ–Ω–∏—è –ï–≤—Ä–æ–ø–æ—á—Ç—ã *</label>
                                        <input type="text" id="editEuropostBranch" class="w-full px-3 py-2 rounded-lg border border-blue-200 focus:ring-2 focus:ring-blue-400" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –Ω–æ–º–µ—Ä –æ—Ç–¥–µ–ª–µ–Ω–∏—è">
                                    </div>
                                    <div id="editBelpostBlock" class="hidden bg-amber-50 border border-amber-200 rounded-xl p-3 space-y-2">
                                        <p class="text-sm font-medium text-amber-800">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –ë–µ–ª–ø–æ—á—Ç–æ–π *</p>
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                            <input type="text" id="editBelpostIndex" class="px-3 py-2 rounded-lg border border-amber-200 focus:ring-2 focus:ring-amber-400" placeholder="–ò–Ω–¥–µ–∫—Å">
                                            <input type="text" id="editBelpostCity" class="px-3 py-2 rounded-lg border border-amber-200 focus:ring-2 focus:ring-amber-400" placeholder="–ù–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç">
                                            <input type="text" id="editBelpostStreet" class="px-3 py-2 rounded-lg border border-amber-200 focus:ring-2 focus:ring-amber-400" placeholder="–£–ª–∏—Ü–∞">
                                            <input type="text" id="editBelpostHouse" class="px-3 py-2 rounded-lg border border-amber-200 focus:ring-2 focus:ring-amber-400" placeholder="–î–æ–º / –∫–≤–∞—Ä—Ç–∏—Ä–∞">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <h3 class="font-semibold text-gray-800 mb-3">–¢–æ–≤–∞—Ä—ã</h3>
                                <div id="editProductsContainer" class="space-y-3 max-h-[350px] overflow-y-auto"></div>
                            </div>
                        </div>

                        <div class="mt-6 flex gap-3">
                            <button onclick="saveEditOrder()" class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button onclick="closeEditOrder()" class="flex-1 bg-gray-200 text-gray-800 py-2 rounded-lg hover:bg-gray-300">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                <div id="adminUsersTab" class="hidden">
                    <h2 class="text-xl font-semibold mb-4">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
                    <div id="adminUsers" class="space-y-4"></div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ –§–∏–Ω–∞–Ω—Å—ã (–ù–û–í–ê–Ø) -->
                <div id="adminFinanceTab" class="hidden">
                    <h2 class="text-xl font-semibold mb-4">üí∏ –§–∏–Ω–∞–Ω—Å—ã –∏ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>

                    <!-- –ì–õ–ê–í–ù–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò (–¢–ï–ö–£–©–ò–ô –ú–ï–°–Ø–¶) -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <!-- –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å -->
                        <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-xl border border-purple-200 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-gray-600 font-semibold">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</h3>
                                <span class="text-2xl">üí∞</span>
                            </div>
                            <p class="text-3xl font-bold text-purple-700" id="calcTotalNetProfitFinal">0 BYN</p>
                            <p class="text-xs text-purple-600 mt-2">–ó–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</p>
                        </div>

                        <!-- –°—É–º–º–∞ –Ω–∞–ª–æ–≥–∞ -->
                        <div class="bg-gradient-to-br from-orange-50 to-orange-100 p-6 rounded-xl border border-orange-200 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-gray-600 font-semibold">–°—É–º–º–∞ –Ω–∞–ª–æ–≥–∞</h3>
                                <span class="text-2xl">üè¶</span>
                            </div>
                            <p class="text-3xl font-bold text-orange-700" id="calcTotalTax">0 BYN</p>
                            <p class="text-xs text-orange-600 mt-2">–ó–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</p>
                        </div>

                        <!-- –û–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã -->
                        <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-xl border border-green-200 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-gray-600 font-semibold">–û–ø–ª–∞—á–µ–Ω–æ –∑–∞–∫–∞–∑–æ–≤</h3>
                                <span class="text-2xl">üí≥</span>
                            </div>
                            <p class="text-3xl font-bold text-green-700" id="calcTotalPaidOrders">0 BYN</p>
                            <p class="text-xs text-green-600 mt-2">–°—É–º–º–∞ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–π</p>
                        </div>
                    </div>

                    <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤ -->
                    <details class="bg-white rounded-lg border mb-8 group">
                        <summary class="cursor-pointer p-4 font-semibold text-gray-700 hover:bg-gray-50 flex justify-between items-center">
                            <span>üìã –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤ –ø—Ä–∏–±—ã–ª–∏ (–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å)</span>
                            <span class="group-open:rotate-180 transition-transform">‚ñº</span>
                        </summary>
                        <div class="p-6 border-t bg-gray-50">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- –†–∞—Å—á–µ—Ç –ø–æ —Ç–æ–≤–∞—Ä–∞–º -->
                                <div class="bg-white p-4 rounded-lg border border-purple-200">
                                    <h4 class="font-bold text-purple-700 mb-3 border-b pb-2">üì¶ –ü—Ä–∏–±—ã–ª—å —Å —Ç–æ–≤–∞—Ä–æ–≤</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">–ü—Ä–∏–±—ã–ª—å (–≥—Ä—è–∑–Ω–∞—è):</span>
                                            <span class="font-mono font-bold" id="calcProfitGoods">0</span>
                                        </div>
                                        <div class="flex justify-between text-red-600">
                                            <span>- –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                                            <span class="font-mono" id="calcCostGoods">0</span>
                                        </div>
                                        <div class="flex justify-between text-orange-600">
                                            <span>- –ù–∞–ª–æ–≥:</span>
                                            <span class="font-mono" id="calcTaxGoods">0</span>
                                        </div>
                                        <div class="flex justify-between border-t pt-2 mt-2 text-lg font-bold text-purple-700 bg-purple-50 p-2 rounded">
                                            <span>= –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å:</span>
                                            <span id="calcNetProfitGoods">0</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- –†–∞—Å—á–µ—Ç –ø–æ –¥–æ—Å—Ç–∞–≤–∫–µ -->
                                <div class="bg-white p-4 rounded-lg border border-blue-200">
                                    <h4 class="font-bold text-blue-700 mb-3 border-b pb-2">üöö –ü—Ä–∏–±—ã–ª—å —Å –¥–æ—Å—Ç–∞–≤–∫–∏</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">–ü—Ä–∏–±—ã–ª—å (–≥—Ä—è–∑–Ω–∞—è):</span>
                                            <span class="font-mono font-bold" id="calcProfitDelivery">0</span>
                                        </div>
                                        <div class="flex justify-between text-red-600">
                                            <span>- –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                                            <span class="font-mono" id="calcCostDelivery">0</span>
                                        </div>
                                        <div class="flex justify-between text-orange-600">
                                            <span>- –ù–∞–ª–æ–≥:</span>
                                            <span class="font-mono" id="calcTaxDelivery">0</span>
                                        </div>
                                        <div class="flex justify-between border-t pt-2 mt-2 text-lg font-bold text-blue-700 bg-blue-50 p-2 rounded">
                                            <span>= –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å:</span>
                                            <span id="calcNetProfitDelivery">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- –°–∫—Ä—ã—Ç—ã–π –¥—É–±–ª–∏–∫–∞—Ç –¥–ª—è JS -->
                            <span id="calcTotalNetProfit" class="hidden"></span>
                        </div>
                    </details>

                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥–æ–¥–∞–º –∏ –º–µ—Å—è—Ü–∞–º -->
                    <div class="bg-gray-50 p-6 rounded-lg mb-6">
                        <h3 class="font-semibold mb-4">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º</h3>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">–ì–æ–¥</label>
                                <select id="statsYear" onchange="updateStatistics()" class="w-full px-4 py-2 border rounded-lg">
                                    <option value="2025" selected>2025</option>
                                    <option value="2026">2026</option>
                                    <option value="2027">2027</option>
                                    <option value="2028">2028</option>
                                    <option value="2029">2029</option>
                                    <option value="2030">2030</option>
                                    <option value="2031">2031</option>
                                    <option value="2032">2032</option>
                                    <option value="2033">2033</option>
                                    <option value="2034">2034</option>
                                    <option value="2035">2035</option>
                                    <option value="2036">2036</option>
                                    <option value="2037">2037</option>
                                    <option value="2038">2038</option>
                                    <option value="2039">2039</option>
                                    <option value="2040">2040</option>
                                    <option value="2041">2041</option>
                                    <option value="2042">2042</option>
                                    <option value="2043">2043</option>
                                    <option value="2044">2044</option>
                                    <option value="2045">2045</option>
                                    <option value="2046">2046</option>
                                    <option value="2047">2047</option>
                                    <option value="2048">2048</option>
                                    <option value="2049">2049</option>
                                    <option value="2050">2050</option>
                                    <option value="2024">2024</option>
                                    <option value="2023">2023</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">–ú–µ—Å—è—Ü</label>
                                <select id="statsMonth" onchange="updateStatistics()" class="w-full px-4 py-2 border rounded-lg">
                                    <option value="all">–í–µ—Å—å –≥–æ–¥</option>
                                    <option value="0">–Ø–Ω–≤–∞—Ä—å</option>
                                    <option value="1">–§–µ–≤—Ä–∞–ª—å</option>
                                    <option value="2">–ú–∞—Ä—Ç</option>
                                    <option value="3">–ê–ø—Ä–µ–ª—å</option>
                                    <option value="4">–ú–∞–π</option>
                                    <option value="5">–ò—é–Ω—å</option>
                                    <option value="6">–ò—é–ª—å</option>
                                    <option value="7">–ê–≤–≥—É—Å—Ç</option>
                                    <option value="8">–°–µ–Ω—Ç—è–±—Ä—å</option>
                                    <option value="9">–û–∫—Ç—è–±—Ä—å</option>
                                    <option value="10">–ù–æ—è–±—Ä—å</option>
                                    <option value="11">–î–µ–∫–∞–±—Ä—å</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">–¢–∏–ø –æ—Ç—á–µ—Ç–∞</label>
                                <select id="statsType" onchange="updateStatistics()" class="w-full px-4 py-2 border rounded-lg">
                                    <option value="summary">–°–≤–æ–¥–∫–∞</option>
                                    <option value="monthly">–ü–æ –º–µ—Å—è—Ü–∞–º</option>
                                    <option value="yearly">–ü–æ –≥–æ–¥–∞–º</option>
                                </select>
                            </div>
                        </div>

                        <div id="statisticsContent" class="space-y-4">
                            <div id="summaryStats" class="bg-white p-4 rounded-lg border">
                                <h4 class="font-semibold mb-3 text-lg">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div class="bg-purple-50 p-3 rounded border border-purple-300">
                                        <p class="text-sm text-gray-600">–ß–ü –∑–∞ —Ç–æ–≤–∞—Ä</p>
                                        <p class="text-xl font-bold text-purple-700" id="statsProfitGoods">0 BYN</p>
                                    </div>
                                    <div class="bg-blue-50 p-3 rounded border border-blue-300">
                                        <p class="text-sm text-gray-600">–ß–ü –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É</p>
                                        <p class="text-xl font-bold text-blue-700" id="statsProfitDelivery">0 BYN</p>
                                    </div>
                                    <div class="bg-green-50 p-3 rounded border border-green-300">
                                        <p class="text-sm text-gray-600">–û–±—â–∞—è –ß–ü</p>
                                        <p class="text-xl font-bold text-green-700" id="statsTotalProfit">0 BYN</p>
                                    </div>
                                    <div class="bg-orange-50 p-3 rounded border border-orange-300">
                                        <p class="text-sm text-gray-600">–û–±—â–∏–π –Ω–∞–ª–æ–≥</p>
                                        <p class="text-xl font-bold text-orange-700" id="statsTotalTax">0 BYN</p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                                    <div class="bg-gray-50 p-3 rounded border">
                                        <p class="text-sm text-gray-600">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</p>
                                        <p class="text-xl font-bold" id="statsTotalOrders">0</p>
                                    </div>
                                    <div class="bg-gray-50 p-3 rounded border">
                                        <p class="text-sm text-gray-600">–û–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</p>
                                        <p class="text-xl font-bold" id="statsPaidOrders">0</p>
                                    </div>
                                    <div class="bg-gray-50 p-3 rounded border">
                                        <p class="text-sm text-gray-600">–°—É–º–º–∞ –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö</p>
                                        <p class="text-xl font-bold" id="statsPaidSum">0 BYN</p>
                                    </div>
                                </div>
                            </div>

                            <div id="monthlyStats" class="hidden bg-white p-4 rounded-lg border">
                                <h4 class="font-semibold mb-3 text-lg">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º</h4>
                                <div id="monthlyStatsContent" class="space-y-2"></div>
                            </div>

                            <div id="yearlyStats" class="hidden bg-white p-4 rounded-lg border">
                                <h4 class="font-semibold mb-3 text-lg">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥–æ–¥–∞–º</h4>
                                <div id="yearlyStatsContent" class="space-y-2"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
                <div id="adminSettingsTab" class="hidden">
                    <div class="flex items-center mb-6">
                        <span class="bg-purple-100 text-purple-700 p-2 rounded-lg mr-3 text-xl">‚öôÔ∏è</span>
                        <h2 class="text-xl font-bold text-gray-800">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- –ö—É—Ä—Å—ã –∏ —Ü–µ–Ω—ã -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                                <span class="w-8 h-8 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center mr-3 text-sm">üí∞</span>
                                –ö—É—Ä—Å—ã –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">–ö—É—Ä—Å —é–∞–Ω—è (BYN)</label>
                                    <input type="number" id="yuanRate" step="0.01"
                                        class="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition font-mono">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">–¶–µ–Ω–∞ –∑–∞ –∫–≥ (BYN)</label>
                                    <input type="number" id="kgPrice" step="0.01"
                                        class="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition font-mono">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">–°–µ–±–µ—Å—Ç. —é–∞–Ω—è</label>
                                    <input type="number" id="costYuan" step="0.01"
                                        class="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition font-mono">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">–°–µ–±–µ—Å—Ç. –∫–≥</label>
                                    <input type="number" id="costKg" step="0.01"
                                        class="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition font-mono">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">–ù–∞–ª–æ–≥ –æ—Ç –ø—Ä–∏–±—ã–ª–∏ (%)</label>
                                    <input type="number" id="taxPercent" step="0.1"
                                        class="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition font-mono">
                                </div>
                            </div>
                            <button onclick="saveRates()"
                                class="mt-6 w-full bg-blue-600 text-white px-4 py-2.5 rounded-xl hover:bg-blue-700 transition font-medium shadow-lg shadow-blue-200">
                                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å—Ü–µ–Ω–∫–∏
                            </button>
                        </div>

                        <!-- –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                                <span class="w-8 h-8 rounded-lg bg-red-50 text-red-600 flex items-center justify-center mr-3 text-sm">üö´</span>
                                –ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                            </h3>
                            <div class="flex space-x-2 mb-4">
                                <input type="text" id="newForbiddenItem" placeholder="–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä..."
                                    class="flex-1 px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500 outline-none transition">
                                <button onclick="addForbiddenItem()"
                                    class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition font-medium">
                                    +
                                </button>
                            </div>
                            <div class="space-y-2 max-h-[250px] overflow-y-auto custom-scrollbar" id="forbiddenItemsAdminList"></div>
                        </div>

                        <!-- –°–ø–æ—Å–æ–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏ -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                                <span class="w-8 h-8 rounded-lg bg-green-50 text-green-600 flex items-center justify-center mr-3 text-sm">üöö</span>
                                –°–ø–æ—Å–æ–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ –†–ë
                            </h3>
                            <div class="flex space-x-2 mb-4">
                                <input type="text" id="newDeliveryMethod" placeholder="–ù–æ–≤—ã–π —Å–ø–æ—Å–æ–±..."
                                    class="flex-1 px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 outline-none transition">
                                <button onclick="addDeliveryMethod()"
                                    class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition font-medium">
                                    +
                                </button>
                            </div>
                            <div class="space-y-2" id="deliveryMethodsList"></div>
                        </div>

                        <!-- –†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                                <span class="w-8 h-8 rounded-lg bg-purple-50 text-purple-600 flex items-center justify-center mr-3 text-sm">üí≥</span>
                                –†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã
                            </h3>
                            <textarea id="paymentDetails" rows="5"
                                class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none transition text-sm"
                                placeholder="–£–∫–∞–∂–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã..."></textarea>
                            <button onclick="savePaymentDetails()"
                                class="mt-4 w-full bg-purple-600 text-white px-4 py-2.5 rounded-xl hover:bg-purple-700 transition font-medium shadow-lg shadow-purple-200">
                                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–≥–æ–≤–æ—Ä–∞-–æ—Ñ–µ—Ä—Ç—ã -->
    <div id="offerModal" class="modal hidden">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">–î–æ–≥–æ–≤–æ—Ä –ø—É–±–ª–∏—á–Ω–æ–π –æ—Ñ–µ—Ä—Ç—ã –Ω–∞ –æ–∫–∞–∑–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã—Ö —É—Å–ª—É–≥</h2>
            <div class="prose text-sm space-y-3 mb-6">
                <p class="text-xs">–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ, –ö—É–∏—Å –í–∞–¥–∏–º –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á, –£–ù–ü BE6333993, –∏–º–µ–Ω—É–µ–º—ã–π –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º ¬´–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å¬ª, –ø—É–±–ª–∏–∫—É–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∏–π –¥–æ–≥–æ–≤–æ—Ä –ø—É–±–ª–∏—á–Ω–æ–π –æ—Ñ–µ—Ä—Ç—ã (–¥–∞–ª–µ–µ ‚Äî ¬´–î–æ–≥–æ–≤–æ—Ä¬ª) –æ –Ω–∏–∂–µ—Å–ª–µ–¥—É—é—â–µ–º:</p>

                <p><strong>1. –ü—Ä–µ–¥–º–µ—Ç –¥–æ–≥–æ–≤–æ—Ä–∞</strong></p>
                <p>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–∫–∞–∑—ã–≤–∞–µ—Ç –ó–∞–∫–∞–∑—á–∏–∫—É —É—Å–ª—É–≥–∏, –≤–∫–ª—é—á–∞—é—â–∏–µ:</p>
                <ul class="list-disc pl-5 space-y-1 text-xs">
                    <li>–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–≤–∞—Ä–∞—Ö –∏ –ø—Ä–æ–¥–∞–≤—Ü–∞—Ö –Ω–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø–ª–æ—â–∞–¥–∫–∞—Ö –ö–∏—Ç–∞–π—Å–∫–æ–π –ù–∞—Ä–æ–¥–Ω–æ–π –†–µ—Å–ø—É–±–ª–∏–∫–∏;</li>
                    <li>–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —É—Å–ª–æ–≤–∏—è–º –∑–∞–∫–∞–∑–∞ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏;</li>
                    <li>–ø–µ—Ä–µ–¥–∞—á—É –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–∫–∞–∑–µ –ø—Ä–æ–¥–∞–≤—Ü—É –ø–æ –ø–æ—Ä—É—á–µ–Ω–∏—é –ó–∞–∫–∞–∑—á–∏–∫–∞;</li>
                    <li>–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ó–∞–∫–∞–∑—á–∏–∫–∞ –æ —Ö–æ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞;</li>
                    <li>–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–º–∏ –∏ –ø–æ—á—Ç–æ–≤—ã–º–∏ —Å–ª—É–∂–±–∞–º–∏.</li>
                </ul>
                <p class="font-semibold mt-2">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–¥–∞–≤—Ü–æ–º, –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º –∏–ª–∏ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤.</p>
                <p class="mt-2">–ü–æ –ø–æ—Ä—É—á–µ–Ω–∏—é –ó–∞–∫–∞–∑—á–∏–∫–∞ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ–∫–∞–∑—ã–≤–∞—Ç—å —É—Å–ª—É–≥–∏ –ø–æ —Å–æ–¥–µ–π—Å—Ç–≤–∏—é –≤ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–∏ –æ–ø–ª–∞—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥ –¥–æ—Å—Ç–∞–≤–∫–∏, –ø–µ—Ä–µ–¥–∞–≤–∞—è –¥–µ–Ω–µ–∂–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –æ—Ç –∏–º–µ–Ω–∏ –∏ –∑–∞ —Å—á—ë—Ç –ó–∞–∫–∞–∑—á–∏–∫–∞ –≤ –∞–¥—Ä–µ—Å –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ –∏ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–æ–≤. –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø–æ –æ–ø–ª–∞—Ç–µ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –ó–∞–∫–∞–∑—á–∏–∫–æ–º –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –ª–∏—Ü.</p>
                <p class="mt-2">–£—Å–ª—É–≥–∏ –æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ, –≤–Ω–µ –º–µ—Å—Ç–∞ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –ó–∞–∫–∞–∑—á–∏–∫–∞, —á–µ—Ä–µ–∑ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä Telegram, –≤ —Ä–∞–º–∫–∞—Ö –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤.</p>
                <div class="bg-yellow-50 p-3 rounded border border-yellow-300 mt-3">
                    <p class="text-xs"><strong>‚ö†Ô∏è –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:</strong> –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–∑–∫–µ –≤–æ–∑–º–æ–∂–Ω—ã —Ñ–æ—Ä—Å-–º–∞–∂–æ—Ä—ã –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ, –Ω–µ–±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–µ –ø–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –∏ –¥—Ä—É–≥–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ —Å—Ä–æ–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏. –¢–∞–∫–∂–µ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –ø—Ä–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ ‚Äî —ç—Ç–æ —Ä–∏—Å–∫, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—á–∏—Ç—ã–≤–∞—Ç—å.</p>
                </div>

                <p><strong>2. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞</strong></p>
                <ul class="list-disc pl-5 space-y-1 text-xs">
                    <li>–ù–∞—Å—Ç–æ—è—â–∏–π –¥–æ–≥–æ–≤–æ—Ä —è–≤–ª—è–µ—Ç—Å—è –ø—É–±–ª–∏—á–Ω—ã–º (—Å—Ç. 396 –ì–ö –†–ë).</li>
                    <li>–†–∞–∑–º–µ—â–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∞ –≤ —Å–µ—Ç–∏ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —è–≤–ª—è–µ—Ç—Å—è –ø—É–±–ª–∏—á–Ω–æ–π –æ—Ñ–µ—Ä—Ç–æ–π (—Å—Ç. 407 –ì–ö –†–ë).</li>
                    <li>–ê–∫—Ü–µ–ø—Ç–æ–º –æ—Ñ–µ—Ä—Ç—ã —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è.</li>
                    <li>–î–æ–≥–æ–≤–æ—Ä –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –ø—Ä–æ—Å—Ç–æ–π –ø–∏—Å—å–º–µ–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ (—Å—Ç. 404, 408 –ì–ö –†–ë).</li>
                </ul>

                <p><strong>3. –ü—Ä–∞–≤–∞ –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ —Å—Ç–æ—Ä–æ–Ω</strong></p>
                <p class="font-semibold">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–±—è–∑—É–µ—Ç—Å—è:</p>
                <ul class="list-disc pl-5 space-y-1 text-xs">
                    <li>–æ–∫–∞–∑–∞—Ç—å —É—Å–ª—É–≥–∏ –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä—ë–º–µ –∏ –≤ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ —Å—Ä–æ–∫–∏;</li>
                    <li>–ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å–≤–µ–¥–µ–Ω–∏—è –ø—Ä–æ–¥–∞–≤—Ü–∞–º –∏ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞–º –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ –ó–∞–∫–∞–∑—á–∏–∫–∞;</li>
                    <li>–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ó–∞–∫–∞–∑—á–∏–∫–∞ –æ —Ö–æ–¥–µ –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥;</li>
                    <li>—Å–æ–±–ª—é–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ó–∞–∫–∞–∑—á–∏–∫–∞.</li>
                </ul>
                <p class="font-semibold mt-2">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –≤–ø—Ä–∞–≤–µ:</p>
                <ul class="list-disc pl-5 space-y-1 text-xs">
                    <li>–ø—Ä–∏–≤–ª–µ–∫–∞—Ç—å —Ç—Ä–µ—Ç—å–∏—Ö –ª–∏—Ü –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π;</li>
                    <li>–ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –æ–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª—É–≥ –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ —É—Å–ª–æ–≤–∏–π –æ–ø–ª–∞—Ç—ã –ó–∞–∫–∞–∑—á–∏–∫–æ–º.</li>
                </ul>
                <p class="font-semibold mt-2">–ó–∞–∫–∞–∑—á–∏–∫ –æ–±—è–∑—É–µ—Ç—Å—è:</p>
                <ul class="list-disc pl-5 space-y-1 text-xs">
                    <li>–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ;</li>
                    <li>—Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–ø–ª–∞—á–∏–≤–∞—Ç—å —É—Å–ª—É–≥–∏ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è;</li>
                    <li>—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –æ–ø–ª–∞—á–∏–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –∏ –¥–æ—Å—Ç–∞–≤–∫—É. –ü–æ –æ—Ç–¥–µ–ª—å–Ω–æ–º—É –ø–æ—Ä—É—á–µ–Ω–∏—é –ó–∞–∫–∞–∑—á–∏–∫–∞ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ–∫–∞–∑–∞—Ç—å —É—Å–ª—É–≥—É –ø–æ —Å–æ–¥–µ–π—Å—Ç–≤–∏—é –≤ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–∏ –æ–ø–ª–∞—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥ –¥–æ—Å—Ç–∞–≤–∫–∏. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø–µ—Ä–µ–¥–∞—á–∏ –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –æ—Ç –∏–º–µ–Ω–∏ –∏ –∑–∞ —Å—á—ë—Ç –ó–∞–∫–∞–∑—á–∏–∫–∞ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ –∞–¥—Ä–µ—Å –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ –∏ (–∏–ª–∏) –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–æ–≤. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–æ–±—Ä–µ—Ç–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –Ω–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∏—Ö —Ü–µ–Ω—É –∏ –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —Ä–∞—Å—á—ë—Ç—ã –º–µ–∂–¥—É –ó–∞–∫–∞–∑—á–∏–∫–æ–º –∏ –ø—Ä–æ–¥–∞–≤—Ü–∞–º–∏ (–ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞–º–∏).</li>
                    <li>—Å–æ–±–ª—é–¥–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Ç–∞–º–æ–∂–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –ø—Ä–∞–≤–∏–ª –≤–≤–æ–∑–∞.</li>
                </ul>

                <p><strong>4. –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ –ø–æ—Ä—è–¥–æ–∫ –æ–ø–ª–∞—Ç—ã</strong></p>
                <ul class="list-disc pl-5 space-y-1 text-xs">
                    <li>–°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é —Å—Ç–æ—Ä–æ–Ω –∏ –¥–æ–≤–æ–¥–∏—Ç—Å—è –¥–æ —Å–≤–µ–¥–µ–Ω–∏—è –ó–∞–∫–∞–∑—á–∏–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞.</li>
                    <li>–û–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≤ –±–µ–ª–æ—Ä—É—Å—Å–∫–∏—Ö —Ä—É–±–ª—è—Ö –Ω–∞ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è.</li>
                </ul>

                <p><strong>5. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç–æ—Ä–æ–Ω</strong></p>
                <ul class="list-disc pl-5 space-y-1 text-xs">
                    <li>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –Ω–∞–¥–ª–µ–∂–∞—â–µ–µ –æ–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª—É–≥ (–ø–µ—Ä–µ–¥–∞—á–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ).</li>
                    <li>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–¥–∞–≤—Ü–æ–≤, –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–æ–≤, –ø–æ—á—Ç–æ–≤—ã—Ö —Å–ª—É–∂–±, —Ç–∞–º–æ–∂–µ–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤.</li>
                    <li>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ü–≤–µ—Ç–∞, —Ä–∞–∑–º–µ—Ä–∞, –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –∏–ª–∏ –∏–Ω—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∑–∞–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–¥–∞–≤—Ü–æ–º.</li>
                    <li>–ó–∞–∫–∞–∑—á–∏–∫ –æ–±—è–∑—É–µ—Ç—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Å–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ —Ç–æ–≤–∞—Ä–µ (–æ–ø–∏—Å–∞–Ω–∏–µ, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã) –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π —É—Å–ª—É–≥ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –∏ –Ω–µ—Å—ë—Ç —Ä–∏—Å–∫ –æ—à–∏–±–æ–∫ –∏–ª–∏ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–µ–π –≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∏–º –¥–∞–Ω–Ω—ã—Ö.</li>
                    <li>–í —Å–ª—É—á–∞–µ –Ω–µ–Ω–∞–¥–ª–µ–∂–∞—â–µ–≥–æ –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –≤–æ–∑–º–µ—â–∞–µ—Ç –ó–∞–∫–∞–∑—á–∏–∫—É –ø—Ä—è–º–æ–π —É—â–µ—Ä–± –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö —É—Å–ª—É–≥.</li>
                </ul>

                <p><strong>6. –û—Ç–∫–∞–∑ –æ—Ç –¥–æ–≥–æ–≤–æ—Ä–∞</strong></p>
                <ul class="list-disc pl-5 space-y-1 text-xs">
                    <li>–ó–∞–∫–∞–∑—á–∏–∫ –≤–ø—Ä–∞–≤–µ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è, –≤–æ–∑–º–µ—Å—Ç–∏–≤ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ–Ω–µ—Å—ë–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã (—Å—Ç. 15 –ó–∞–∫–æ–Ω–∞ –†–ë ¬´–û –∑–∞—â–∏—Ç–µ –ø—Ä–∞–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π¬ª).</li>
                    <li>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –æ–∫–∞–∑–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥ –≤–æ–∑–≤—Ä–∞—Ç—É –Ω–µ –ø–æ–¥–ª–µ–∂–∏—Ç.</li>
                </ul>

                <p><strong>7. –§–æ—Ä—Å-–º–∞–∂–æ—Ä</strong></p>
                <p class="text-xs">–°—Ç–æ—Ä–æ–Ω—ã –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —á–∞—Å—Ç–∏—á–Ω–æ–µ –∏–ª–∏ –ø–æ–ª–Ω–æ–µ –Ω–µ–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É, –µ—Å–ª–∏ –æ–Ω–æ –≤—ã–∑–≤–∞–Ω–æ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏ –Ω–µ–ø—Ä–µ–æ–¥–æ–ª–∏–º–æ–π —Å–∏–ª—ã (–ø–æ–∂–∞—Ä, –Ω–∞–≤–æ–¥–Ω–µ–Ω–∏–µ, –≤–æ–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ –¥—Ä.).</p>

                <p><strong>8. –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å–ø–æ—Ä–æ–≤</strong></p>
                <ul class="list-disc pl-5 space-y-1 text-xs">
                    <li>–í—Å–µ —Å–ø–æ—Ä—ã —Ä–µ—à–∞—é—Ç—Å—è –ø—É—Ç—ë–º –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤.</li>
                    <li>–ü—Ä–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –≤ —Å—É–¥–µ–±–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ë–µ–ª–∞—Ä—É—Å—å.</li>
                </ul>

                <p><strong>9. –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞</strong></p>
                <ul class="list-disc pl-5 space-y-1 text-xs">
                    <li>–î–æ–≥–æ–≤–æ—Ä —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–∫–ª—é—á—ë–Ω–Ω—ã–º –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –º–æ–º–µ–Ω—Ç–∞ –æ–ø–ª–∞—Ç—ã –ó–∞–∫–∞–∑—á–∏–∫–æ–º —É—Å–ª—É–≥ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è. –° —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ —Å—Ç–æ—Ä–æ–Ω—ã –ø—Ä–∏–æ–±—Ä–µ—Ç–∞—é—Ç –≤–∑–∞–∏–º–Ω—ã–µ –ø—Ä–∞–≤–∞ –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –ø–æ –î–æ–≥–æ–≤–æ—Ä—É.</li>
                    <li>–î–æ–≥–æ–≤–æ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞—Å—Ç–æ—Ä–≥–Ω—É—Ç –ª—é–±–æ–π –∏–∑ —Å—Ç–æ—Ä–æ–Ω —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –∑–∞ 7 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π.</li>
                </ul>

                <p><strong>10. –†–µ–∫–≤–∏–∑–∏—Ç—ã –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</strong></p>
                <div class="bg-gray-50 p-3 rounded border text-xs space-y-1">
                    <p><strong>–ö—É–∏—Å –í–∞–¥–∏–º –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á</strong></p>
                    <p>–ê–¥—Ä–µ—Å: –†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–µ–ª–∞—Ä—É—Å—å, –ë—Ä–µ—Å—Ç—Å–∫–∞—è –æ–±–ª., –≥. –ò–≤–∞—Ü–µ–≤–∏—á–∏, —É–ª. –î–µ–ø—É—Ç–∞—Ç—Å–∫–∞—è, –¥.43\2</p>
                    <p>–£–ù–ü BE6333993</p>
                    <p>–°—á—ë—Ç: BY86 ALFA 3014 32SA 0J00 1027 0000 –≤ –ó–ê–û ¬´–ê–õ–¨–§–ê-–ë–ê–ù–ö¬ª, –ë–ò–ö ALFABY2X</p>
                </div>
            </div>
            <button onclick="closeOfferModal()"
                class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700">
                –ó–∞–∫—Ä—ã—Ç—å
            </button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ -->
    <div id="paymentModal" class="modal hidden">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã</h2>
            <div class="bg-gray-50 p-4 rounded-lg mb-4">
                <p class="font-semibold mb-2">–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã:</p>
                <div id="modalPaymentDetails" class="text-sm whitespace-pre-line"></div>
            </div>
            <p class="text-sm text-gray-600 mb-4">–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –∑–∞–≥—Ä—É–∑–∏—Ç–µ —á–µ–∫ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ú–æ–∏ –∑–∞–∫–∞–∑—ã"</p>
            <button onclick="closePaymentModal()"
                class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700">
                –ü–æ–Ω—è—Ç–Ω–æ
            </button>
        </div>
    </div>

    <script>
        /* =============================
           VIEW INIT (force login screen on load)
        ==============================*/
        window.addEventListener('load', () => {
            try {
                currentUser = null;
                hideAllViews();
                document.getElementById('loginForm').reset();
                document.getElementById('registerForm').reset();
                // –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø—Ä—è—á–µ–º –≤—Å–µ –º–æ–¥–∞–ª–∫–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ
                ['offerModal','paymentModal','weightModal','editOrderModal'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.classList.add('hidden');
                });
                if (typeof closeOfferModal === 'function') closeOfferModal();
                if (typeof closePaymentModal === 'function') closePaymentModal();
                // –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–Ω
                document.getElementById('loginView').classList.remove('hidden');
            } catch (e) {
                console.warn('Init view reset error:', e);
            }
        });

        /* =============================
           MODAL HELPERS (safe stubs)
        ==============================*/
        function showOfferModal() {
            const m = document.getElementById('offerModal');
            if (m) m.classList.remove('hidden');
        }
        function closeOfferModal() {
            const m = document.getElementById('offerModal');
            if (m) m.classList.add('hidden');
        }
        function showPaymentModal(orderNumber = '', paymentDetails = '') {
            const m = document.getElementById('paymentModal');
            if (!m) return;
            const numEl = document.getElementById('modalOrderNumber');
            const payEl = document.getElementById('modalPaymentDetails');
            if (numEl) numEl.textContent = orderNumber;
            if (payEl && paymentDetails) payEl.textContent = paymentDetails;
            m.classList.remove('hidden');
        }
        function closePaymentModal() {
            const m = document.getElementById('paymentModal');
            if (m) m.classList.add('hidden');
        }

        /* =============================
           CORE / DATA INIT (SUPABASE)
           -----------------------------
           - Supabase client & helpers
           - Local fallback storage for offline
        ==============================*/
        // Supabase credentials (hardcoded to your project)
        const SUPABASE_URL = 'https://becvuuxjxvjhuojpinfb.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJlY3Z1dXhqeHZqaHVvanBpbmZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyNzY0MDgsImV4cCI6MjA4MDg1MjQwOH0.FAznI4gEGCU3afTVdmzjlTNdLA7_39302pCYuo09bko';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (SHA-256)
        async function hashPassword(password) {
            const msgUint8 = new TextEncoder().encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // –õ–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à (–¥–ª—è –æ—Ñ–ª–∞–π–Ω–∞) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ Supabase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
        let users = [];
        let orders = [];
        let settings = {
            yuanRate: 13.50,
            kgPrice: 500,
            costYuan: 10,
            costKg: 300,
            taxPercent: 10,
            deliveryMethods: ['–°–∞–º–æ–≤—ã–≤–æ–∑', '–ï–≤—Ä–æ–ø–æ—á—Ç–∞', '–ë–µ–ª–ø–æ—á—Ç–∞'],
            paymentDetails: '–ö–∞—Ä—Ç–∞: 1234 5678 9012 3456\n–ü–æ–ª—É—á–∞—Ç–µ–ª—å: –û–û–û "–î–æ—Å—Ç–∞–≤–∫–∞"\n–ë–∞–Ω–∫: –°–±–µ—Ä–±–∞–Ω–∫',
            forbiddenItems: ['–û—Ä—É–∂–∏–µ', '–í–∑—Ä—ã–≤—á–∞—Ç—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞', '–ù–∞—Ä–∫–æ—Ç–∏–∫–∏', '–ö–æ–Ω—Ç—Ä–∞—Ñ–∞–∫—Ç']
        };
        let settingsId = null; // id —Å—Ç—Ä–æ–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ Supabase (–µ—Å–ª–∏ –µ—Å—Ç—å)
        let orderCounter = 0;

        let currentUser = null;
        let currentWeightOrderId = null;
        let currentEditOrderId = null;
        let clientSearchTerm = '';

        const statusFlow = ['–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã','–û–ø–ª–∞—á–µ–Ω','–í—ã–∫—É–ø–ª–µ–Ω','–û—Ç–ø—Ä–∞–≤–ª–µ–Ω –∏–∑ –ö–∏—Ç–∞—è','–ü—Ä–∏–±—ã–ª –≤ –ú–æ—Å–∫–≤—É','–î–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –ë–µ–ª–∞—Ä—É—Å—å','–î–æ—Å—Ç–∞–≤–ª–µ–Ω'];

        /* =============================
           PHOTO MODAL (preview)
        ==============================*/
        function openPhotoModal(url) {
            if (!url) return;
            const overlay = document.createElement('div');
            overlay.className = 'fixed inset-0 bg-black/70 flex items-center justify-center z-[3000] p-4';
            overlay.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-[90vw] max-h-[90vh] overflow-auto relative">
                    <button class="absolute top-2 right-2 bg-black/60 text-white rounded-full w-8 h-8 flex items-center justify-center" onclick="this.closest('.photo-overlay')?.remove()">‚úï</button>
                    <img src="${url}" alt="–§–æ—Ç–æ" class="block max-w-full max-h-[90vh] object-contain rounded-2xl">
                </div>
            `;
            overlay.classList.add('photo-overlay');
            overlay.addEventListener('click', (e)=>{
                if (e.target === overlay) overlay.remove();
            });
            document.body.appendChild(overlay);
        }

        /* =============================
           TOASTS / NOTIFICATIONS
        ==============================*/
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            if (!container) return alert(message);
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `<span>${icons[type] || icons.info}</span><span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        /* =============================
           AUTH / USER MANAGEMENT
        ==============================*/
        // –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (Supabase)
        async function ensureDefaultAdmin() {
            if (!supabase) return; // —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω Supabase
            const { data: existing } = await supabase
                .from('users')
                .select('id')
                .eq('phone','admin')
                .limit(1)
                .maybeSingle();
            if (existing) return;
            const hashed = await hashPassword('admin');
            await supabase.from('users').insert({
                full_name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                phone: 'admin',
                telegram: '@admin',
                password_hash: hashed,
                is_admin: true
            });
        }
        ensureDefaultAdmin();

        // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function showLogin() {
            hideAllViews();
            document.getElementById('loginView').classList.remove('hidden');
        }

        function showRegister() {
            hideAllViews();
            document.getElementById('registerView').classList.remove('hidden');
        }

        function showAdminLogin() {
            showLogin();
            document.getElementById('loginPhone').value = 'admin';
            document.getElementById('loginPassword').value = 'admin';
        }

        function hideAllViews() {
            document.getElementById('loginView').classList.add('hidden');
            document.getElementById('registerView').classList.add('hidden');
            document.getElementById('clientView').classList.add('hidden');
            document.getElementById('adminView').classList.add('hidden');
        }

        function logout() {
            currentUser = null;
            showLogin();
        }

        /* =============================
           AUTH HANDLERS
        ==============================*/
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const phone = document.getElementById('regPhone').value.trim();
            const hashedPass = await hashPassword(document.getElementById('regPassword').value);
            const fullName = document.getElementById('regFullName').value.trim();
            const telegram = document.getElementById('regTelegram').value.trim();

            if (supabase) {
                const { data: existing } = await supabase
                    .from('users')
                    .select('id')
                    .eq('phone', phone)
                    .limit(1)
                    .maybeSingle();
                if (existing) {
                    showToast('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!', 'error');
                    return;
                }
                const { error } = await supabase.from('users').insert({
                    full_name: fullName,
                    phone,
                    telegram,
                    password_hash: hashedPass,
                    is_admin: false
                });
                if (error) {
                    showToast('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message, 'error');
                    return;
                }
            } else {
                if (users.find(u => u.phone === phone)) {
                    showToast('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!', 'error');
                    return;
                }
                users.push({
                    fullName,
                    phone,
                    telegram,
                    password: hashedPass,
                    isAdmin: false,
                    registeredAt: new Date().toISOString()
                });
                saveUsers();
            }

            showToast('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.', 'success');
            showLogin();
            document.getElementById('registerForm').reset();
        });

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const phone = document.getElementById('loginPhone').value.trim();
            const password = document.getElementById('loginPassword').value;
            const hashedPass = await hashPassword(password);
            let finalUser = null;

            if (supabase) {
                const { data, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('phone', phone)
                    .eq('password_hash', hashedPass)
                    .maybeSingle();
                if (error || !data) {
                    showToast('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!', 'error');
                    return;
                }
                finalUser = {
                    id: data.id,
                    fullName: data.full_name,
                    phone: data.phone,
                    telegram: data.telegram,
                    isAdmin: data.is_admin
                };
            } else {
                const user = users.find(u => u.phone === phone && u.password === hashedPass);
                if (!user && phone === 'admin') {
                    const legacyAdmin = users.find(u => u.phone === 'admin' && u.password === 'admin');
                    if (legacyAdmin && password === 'admin') {
                        legacyAdmin.password = await hashPassword('admin');
                        saveUsers();
                    }
                }
                finalUser = users.find(u => u.phone === phone && u.password === hashedPass);
                if (!finalUser) {
                    showToast('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!', 'error');
                    return;
                }
            }

            // —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (uuid –∏–∑ –ë–î –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω)
            finalUser.userKey = finalUser.id || finalUser.phone;
            currentUser = finalUser;
            await initData();
            if (finalUser.isAdmin) {
                await showAdminPanel();
            } else {
                await showClientPanel();
            }
            document.getElementById('loginForm').reset();
        });

        /* =============================
           SUPABASE HELPERS (orders/settings)
        ==============================*/
        async function fetchSettings() {
            try {
                // –í—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ–º —Å –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–µ–∫ id=1
                settingsId = settingsId || 1;
                if (supabase) {
                    const { data, error } = await supabase
                        .from('settings')
                        .select('*')
                        .eq('id', 1)
                        .maybeSingle();

                    if (error && error.code !== 'PGRST116') {
                        console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Supabase:', error.message);
                        showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫: ' + error.message, 'warning');
                    }

                    if (data) {
                        settingsId = data.id ?? 1;
                        settings = {
                            yuanRate: Number(data.yuan_rate ?? settings.yuanRate),
                            kgPrice: Number(data.kg_price ?? settings.kgPrice),
                            costYuan: Number(data.cost_yuan ?? settings.costYuan),
                            costKg: Number(data.cost_kg ?? settings.costKg),
                            taxPercent: Number(data.tax_percent ?? settings.taxPercent),
                            deliveryMethods: data.delivery_methods || settings.deliveryMethods,
                            paymentDetails: data.payment_details || settings.paymentDetails,
                            forbiddenItems: data.forbidden_items || settings.forbiddenItems
                        };
                    } else {
                        // –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ—Ç –≤ –ë–î ‚Äî —Å–æ–∑–¥–∞—ë–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å id=1
                        const { data: created, error: createErr } = await supabase.from('settings').insert({
                            id: 1,
                            yuan_rate: settings.yuanRate,
                            kg_price: settings.kgPrice,
                            cost_yuan: settings.costYuan,
                            cost_kg: settings.costKg,
                            tax_percent: settings.taxPercent,
                            delivery_methods: settings.deliveryMethods,
                            payment_details: settings.paymentDetails,
                            forbidden_items: settings.forbiddenItems
                        }).select().maybeSingle();
                        if (createErr) {
                            console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫:', createErr.message);
                            showToast('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫: ' + createErr.message, 'error');
                        }
                        if (created) settingsId = created.id || 1;
                    }
                } else {
                    const storedSettings = localStorage.getItem('settings');
                    if (storedSettings) {
                        settings = JSON.parse(storedSettings);
                    }
                }
            } catch (err) {
                console.error('fetchSettings fatal:', err);
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'error');
            }
        }

        async function persistSettings() {
            try {
                settingsId = settingsId || 1;
                if (supabase) {
                    const payload = {
                        id: settingsId,
                        yuan_rate: Number(settings.yuanRate || 0),
                        kg_price: Number(settings.kgPrice || 0),
                        cost_yuan: Number(settings.costYuan || 0),
                        cost_kg: Number(settings.costKg || 0),
                        tax_percent: Number(settings.taxPercent || 0),
                        delivery_methods: settings.deliveryMethods,
                        payment_details: settings.paymentDetails,
                        forbidden_items: settings.forbiddenItems
                    };
                    const { data, error } = await supabase.from('settings').upsert(payload).select().maybeSingle();
                    if (error) {
                        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:', error.message);
                        showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫: ' + error.message, 'error');
                    }
                    if (data) settingsId = data.id || 1;
                } else {
                    saveSettings();
                }
            } catch (err) {
                console.error('persistSettings fatal:', err);
                showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'error');
            }
        }

        function parseOrderRow(row, products = []) {
            return {
                id: row.order_number,
                userId: row.user_id,
                userPhone: (row.users && row.users.phone) || row.user_phone || row.user_id || '',
                userName: (row.users && row.users.full_name) || row.user_name || '',
                userTelegram: (row.users && row.users.telegram) || row.user_telegram || '',
                deliveryMethod: row.delivery_method,
                deliveryDetails: row.delivery_details || {},
                products: products,
                totalSum: Number(row.total_sum || 0),
                receipt: row.receipt || null,
                deliveryCost: row.delivery_cost === null ? null : Number(row.delivery_cost),
                totalToPay: row.total_to_pay === null ? null : Number(row.total_to_pay),
                deliveryReceipt: row.delivery_receipt || null,
                totalWeight: Number(row.total_weight || 0),
                status: row.status || '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã',
                createdAt: row.created_at || new Date().toISOString()
            };
        }

        function prepareOrderRow(order) {
            return {
                order_number: order.id,
                user_id: order.userId,
                delivery_method: order.deliveryMethod,
                delivery_details: order.deliveryDetails || {},
                total_sum: order.totalSum || 0,
                receipt: order.receipt || null,
                delivery_cost: order.deliveryCost === undefined ? null : order.deliveryCost,
                total_to_pay: order.totalToPay === undefined ? null : order.totalToPay,
                delivery_receipt: order.deliveryReceipt || null,
                total_weight: order.totalWeight || 0,
                status: order.status || '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã',
                created_at: order.createdAt || new Date().toISOString()
            };
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–ª—è –∞–¥–º–∏–Ω–∫–∏)
        async function fetchUsers() {
            try {
                if (supabase) {
                    const { data, error } = await supabase
                        .from('users')
                        .select('id, full_name, phone, telegram, registered_at, created_at, is_admin')
                        .order('registered_at', { ascending: true });
                    if (error) throw error;
                    users = (data || []).map(u => ({
                        id: u.id,
                        fullName: u.full_name,
                        phone: u.phone,
                        telegram: u.telegram,
                        registeredAt: u.registered_at || u.created_at,
                        isAdmin: !!u.is_admin
                    }));
                } else {
                    const storedUsers = localStorage.getItem('users');
                    users = storedUsers ? JSON.parse(storedUsers) : [];
                }
            } catch (err) {
                console.error('fetchUsers error:', err);
                showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ' + (err.message || err), 'warning');
            }
        }

        async function fetchOrders() {
            if (supabase) {
                try {
                    const { data: ordersData, error } = await supabase
                        .from('orders')
                        .select('*, users(full_name, telegram, phone), order_items(*)')
                        .order('created_at', { ascending: true });
                    if (error) {
                        console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤ Supabase:', error.message);
                        showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤: ' + error.message, 'warning');
                        return;
                    }

                    // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤ ‚Äî –æ—á–∏—â–∞–µ–º
                    if (!ordersData || !ordersData.length) {
                        orders = [];
                        orderCounter = 0;
                        return;
                    }

                    orders = (ordersData || []).map(row => {
                        const prodRaw = Array.isArray(row.order_items) ? row.order_items : [];
                        // –º–∞–ø–ø–∏–º –ø–æ–ª—è –∏–∑ snake_case –≤ camelCase + –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
                        const seen = new Set();
                        const prod = [];
                        prodRaw.forEach(p => {
                            if (!p || p.id == null) return;
                            if (seen.has(p.id)) return;
                            seen.add(p.id);
                            prod.push({
                                id: p.id,
                                link: p.link,
                                price: Number(p.price || 0),
                                quantity: Number(p.quantity || 0),
                                color: p.color || '',
                                size: p.size || '',
                                needPhoto: !!p.need_photo,
                                comment: p.comment || '',
                                trackingNumber: p.tracking_number || '',
                                weight: Number(p.weight || 0),
                                warehousePhoto: p.warehouse_photo || null,
                                productPhoto: p.product_photo || null
                            });
                        });
                        return parseOrderRow(row, prod);
                    });

                    const maxNum = orders.reduce((max, o) => {
                        const n = parseInt((o.id || '').replace('BY-', '')) || 0;
                        return Math.max(max, n);
                    }, 0);
                    orderCounter = Math.max(orderCounter, maxNum);
                } catch (err) {
                    console.error('fetchOrders fatal:', err);
                    showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤', 'error');
                }
            } else {
                const storedOrders = localStorage.getItem('orders');
                if (storedOrders) {
                    orders = JSON.parse(storedOrders);
                    const maxNum = orders.reduce((max, o) => {
                        const n = parseInt((o.id || '').replace('BY-', '')) || 0;
                        return Math.max(max, n);
                    }, 0);
                    orderCounter = Math.max(orderCounter, maxNum);
                }
            }
        }

        async function persistOrder(order) {
            if (supabase) {
                try {
                    // —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–≤–∞—Ä—ã –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç —Å—Ç—Ä–æ–∫–∏ –∑–∞–∫–∞–∑–∞
                    const products = Array.isArray(order.products) ? order.products : [];
                    // –æ—Ç—Å–µ–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Ç–æ–≤–∞—Ä—ã (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö), —á—Ç–æ–±—ã –Ω–µ –ø–ª–æ–¥–∏—Ç—å –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
                    const filteredProducts = products.filter(p => {
                        return (
                            (p.link && p.link.trim() !== '') ||
                            Number(p.price) > 0 ||
                            Number(p.quantity) > 0 ||
                            (p.color && p.color.trim() !== '') ||
                            (p.size && p.size.trim() !== '') ||
                            (p.comment && p.comment.trim() !== '') ||
                            (p.trackingNumber && p.trackingNumber.trim() !== '') ||
                            (p.needPhoto === true) ||
                            Number(p.weight) > 0 ||
                            p.warehousePhoto ||
                            p.productPhoto
                        );
                    });

                    const row = prepareOrderRow(order);
                    const payload = { ...row };
                    delete payload.products;

                    const { data, error } = await supabase
                        .from('orders')
                        .upsert(payload, { onConflict: 'order_number' })
                        .select('id');
                    if (error) throw error;

                    const orderId = data?.[0]?.id;
                    if (orderId) {
                        // —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∏ –≤—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ
                        await supabase.from('order_items').delete().eq('order_id', orderId);
                        if (filteredProducts.length) {
                            const itemsPayload = filteredProducts.map(p => ({
                                order_id: orderId,
                                link: p.link,
                                price: p.price,
                                quantity: p.quantity,
                                color: p.color,
                                size: p.size,
                                need_photo: p.needPhoto,
                                comment: p.comment,
                                tracking_number: p.trackingNumber,
                                weight: p.weight,
                                warehouse_photo: p.warehousePhoto,
                                product_photo: p.productPhoto
                            }));
                            const { error: insErr } = await supabase.from('order_items').insert(itemsPayload);
                            if (insErr) throw insErr;
                        }
                    }
                    return true;
                } catch (err) {
                    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–∫–∞–∑:', err.message || err);
                    showToast('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–∫–∞–∑: ' + (err.message || err), 'error');
                    return false;
                }
            } else {
                saveOrders();
                return true;
            }
        }

        async function deleteOrder(orderId) {
            orders = orders.filter(o => o.id !== orderId);
            if (supabase) {
                const { error } = await supabase.from('orders').delete().eq('order_number', orderId);
                if (error) console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑:', error.message);
            } else {
                saveOrders();
            }
        }

        // —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
        async function syncOrdersFromServer() {
            // –ü—Ä–æ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ —Ç—è–Ω–µ–º –∑–∞–∫–∞–∑—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –∫–∞–∫ –≤ fetchOrders
            await fetchOrders();
            const maxNum = orders.reduce((max, o) => {
                const n = parseInt((o.id || '').replace('BY-', '')) || 0;
                return Math.max(max, n);
            }, 0);
            orderCounter = Math.max(orderCounter, maxNum);
            localStorage.setItem('orderCounter', orderCounter);
        }

        async function initData() {
            await fetchSettings();
            await fetchOrders();
            await syncOrdersFromServer();
            // orderCounter –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
            const storedCounter = parseInt(localStorage.getItem('orderCounter') || '0', 10);
            orderCounter = Math.max(orderCounter, storedCounter);
        }

        /* =============================
           CLIENT PANEL
        ==============================*/

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å –∫–ª–∏–µ–Ω—Ç–∞
        async function showClientPanel() {
            hideAllViews();
            await fetchSettings();
            await fetchOrders();
            document.getElementById('clientView').classList.remove('hidden');
            document.getElementById('clientName').textContent = currentUser.fullName;

            const deliverySelect = document.getElementById('deliveryMethod');
            deliverySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</option>';
            settings.deliveryMethods.forEach(method => {
                deliverySelect.innerHTML += `<option value="${method}">${method}</option>`;
            });

            document.getElementById('displayYuanRate').textContent = settings.yuanRate;

            const forbiddenWarning = document.getElementById('forbiddenItemsWarning');
            const forbiddenList = document.getElementById('forbiddenItemsList');
            if (settings.forbiddenItems && settings.forbiddenItems.length > 0) {
                forbiddenWarning.classList.remove('hidden');
                forbiddenList.innerHTML = settings.forbiddenItems.map(item => `<li>${item}</li>`).join('');
            } else {
                forbiddenWarning.classList.add('hidden');
            }

            // –∫–Ω–æ–ø–∫–∞ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –≤ —à–∞–ø–∫–µ ¬´–ú–æ–∏ –∑–∞–∫–∞–∑—ã¬ª
            const payBtn = document.getElementById('clientPaymentDetailsBtn');
            if (payBtn) {
                payBtn.onclick = () => showPaymentModal('', settings.paymentDetails || '');
            }

            document.getElementById('productsContainer').innerHTML = '';
            addProductRow();

            loadClientOrders();
        }

        // –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É —Ç–æ–≤–∞—Ä–∞ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
        function addProductRow() {
            const container = document.getElementById('productsContainer');
            const index = container.children.length;

            const productRow = document.createElement('div');
            productRow.className = 'border p-4 rounded-lg bg-white';
            productRow.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-semibold">–¢–æ–≤–∞—Ä ${index + 1}</h4>
                    ${index > 0 ? `<button type="button" onclick="removeProductRow(this)" class="text-red-500 hover:text-red-700 text-sm">–£–¥–∞–ª–∏—Ç—å</button>` : ''}
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium mb-1">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä *</label>
                        <input type="url" required class="product-link w-full px-3 py-2 border rounded-lg text-sm" placeholder="https://...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">–¶–µ–Ω–∞ (—é–∞–Ω–∏) *</label>
                        <input type="number" min="0" step="0.01" required class="product-price w-full px-3 py-2 border rounded-lg text-sm" placeholder="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ *</label>
                        <input type="number" min="1" step="1" required class="product-qty w-full px-3 py-2 border rounded-lg text-sm" value="1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">–¶–≤–µ—Ç</label>
                        <input type="text" class="product-color w-full px-3 py-2 border rounded-lg text-sm" placeholder="–¶–≤–µ—Ç">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">–†–∞–∑–º–µ—Ä</label>
                        <input type="text" class="product-size w-full px-3 py-2 border rounded-lg text-sm" placeholder="–†–∞–∑–º–µ—Ä">
                    </div>
                    <div class="md:col-span-2">
                        <label class="inline-flex items-center gap-2 text-sm font-medium mb-1">
                            <input type="checkbox" class="product-need-photo h-4 w-4 text-purple-600"> –ù—É–∂–Ω–æ —Ñ–æ—Ç–æ —Å–æ —Å–∫–ª–∞–¥–∞
                        </label>
                        <label class="block text-sm font-medium mb-1 mt-2">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                        <textarea class="product-comment w-full px-3 py-2 border rounded-lg text-sm" rows="2" placeholder="–ü–æ–∂–µ–ª–∞–Ω–∏—è –ø–æ –∑–∞–∫–∞–∑—É"></textarea>
                    </div>
                </div>
            `;
            container.appendChild(productRow);
            calculateTotalSum();
        }

        function removeProductRow(btn) {
            const row = btn.closest('div.border');
            if (row) row.remove();
            calculateTotalSum();
        }

        function handleDeliveryExtras() {
            const method = document.getElementById('deliveryMethod').value;
            const europost = document.getElementById('europostBlock');
            const belpost = document.getElementById('belpostBlock');
            europost.classList.add('hidden');
            belpost.classList.add('hidden');
            if (method === '–ï–≤—Ä–æ–ø–æ—á—Ç–∞') {
                europost.classList.remove('hidden');
            }
            if (method === '–ë–µ–ª–ø–æ—á—Ç–∞') {
                belpost.classList.remove('hidden');
            }
        }

        function calculateTotalSum() {
            const rate = Number(settings.yuanRate || 0);
            let sum = 0;
            document.querySelectorAll('#productsContainer .border').forEach(row => {
                const price = Number(row.querySelector('.product-price')?.value || 0);
                const qty = Number(row.querySelector('.product-qty')?.value || 0);
                sum += price * rate * qty;
            });
            document.getElementById('totalSum').textContent = sum.toFixed(2);
        }

        /* =============================
           ORDER SUBMIT (client)
        ==============================*/
        document.getElementById('orderForm').addEventListener('input', calculateTotalSum);
        document.getElementById('orderForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const totalSumValue = parseFloat(document.getElementById('totalSum').textContent) || 0;
            if (totalSumValue < 100) {
                showToast('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ ‚Äî 100 BYN. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–ª–∏ —É–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.', 'warning');
                return;
            }
            const method = document.getElementById('deliveryMethod').value;
            if (!method) {
                showToast('–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏', 'warning');
                return;
            }
            const products = [];
            document.querySelectorAll('#productsContainer .border').forEach(row => {
                const link = (row.querySelector('.product-link')?.value || '').trim();
                const price = Number(row.querySelector('.product-price')?.value || 0);
                const quantity = Number(row.querySelector('.product-qty')?.value || 0);
                // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
                if (!link || price <= 0 || quantity <= 0) return;
                products.push({
                    link,
                    price,
                    quantity,
                    color: row.querySelector('.product-color')?.value || '',
                    size: row.querySelector('.product-size')?.value || '',
                    needPhoto: row.querySelector('.product-need-photo')?.checked || false,
                    comment: row.querySelector('.product-comment')?.value || '',
                });
            });
            if (!products.length) {
                showToast('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä —Å —Ü–µ–Ω–æ–π –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º', 'warning');
                return;
            }

            // delivery details
            const deliveryDetails = {};
            if (method === '–ï–≤—Ä–æ–ø–æ—á—Ç–∞') deliveryDetails.europostBranch = document.getElementById('europostBranch').value;
            if (method === '–ë–µ–ª–ø–æ—á—Ç–∞') {
                deliveryDetails.index = document.getElementById('belpostIndex').value;
                deliveryDetails.city = document.getElementById('belpostCity').value;
                deliveryDetails.street = document.getElementById('belpostStreet').value;
                deliveryDetails.house = document.getElementById('belpostHouse').value;
            }

            // upload receipt (optional)
            const receiptFile = document.getElementById('paymentReceipt').files[0];
            let receiptBase64 = null;
            if (receiptFile) {
                receiptBase64 = await fileToBase64(receiptFile);
            }

            orderCounter += 1;
            const orderId = `BY-${orderCounter.toString().padStart(2,'0')}`;
            const newOrder = {
                id: orderId,
                userId: currentUser.userKey || currentUser.phone,
                userPhone: currentUser.phone || '',
                userName: currentUser.fullName,
                userTelegram: currentUser.telegram,
                deliveryMethod: method,
                deliveryDetails,
                products,
                totalSum: totalSumValue,
                receipt: receiptBase64,
                deliveryCost: null,
                totalToPay: null,
                deliveryReceipt: null,
                totalWeight: 0,
                productPhotos: [],
                status: '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã',
                createdAt: new Date().toISOString()
            };
            orders.push(newOrder);
            await persistOrder(newOrder);
            localStorage.setItem('orderCounter', orderCounter);
            showPaymentModal(orderId, settings.paymentDetails || '');
            showToast('–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω! –ù–æ–º–µ—Ä: ' + orderId, 'success');
            document.getElementById('orderForm').reset();
            document.getElementById('productsContainer').innerHTML = '';
            addProductRow();
            loadClientOrders();
        });

        async function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        async function handleReceiptUpload(orderId, kind, inputEl) {
            try {
                const file = inputEl.files?.[0];
                if (!file) return;
                const base64 = await fileToBase64(file);
                const order = orders.find(o => o.id === orderId);
                if (!order) return;
                if (kind === 'delivery') order.deliveryReceipt = base64; else order.receipt = base64;
                await persistOrder(order);
                showToast('–ß–µ–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω', 'success');
                loadClientOrders();
                loadAdminOrders();
            } catch (err) {
                console.error('Receipt upload error:', err);
                showToast('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ–∫', 'error');
            } finally {
                inputEl.value = '';
            }
        }

        function loadClientOrders() {
            const list = document.getElementById('clientOrders');
            list.innerHTML = '';
            const userKey = currentUser.userKey || currentUser.phone;
            const allOrders = orders.filter(o => o.userId === userKey);

            // —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫—É
            const q = (clientSearchTerm || '').trim().toLowerCase();
            const userOrders = q ? allOrders.filter(o => (o.id || '').toLowerCase().includes(q)) : allOrders;

            userOrders.forEach(o => {
                const productsHtml = (o.products || []).map((p, idx) => `
                    <div class="flex items-start gap-3 border-b pb-2 mb-2">
                        <div class="text-gray-400 text-sm">${idx + 1}.</div>
                        <div class="flex-1 text-sm">
                            <div class="flex items-center gap-2 flex-wrap">
                                <a href="${p.link || '#'}" target="_blank" class="text-purple-600 break-all">${p.link || '‚Äî'}</a>
                                ${p.trackingNumber ? `<span class="bg-blue-50 text-blue-700 px-2 py-0.5 rounded text-xs">–¢—Ä–µ–∫: ${p.trackingNumber}</span>` : ''}
                            </div>
                            <p class="text-gray-600 text-xs">${p.quantity || 1} —à—Ç √ó ${p.price || 0} ¬•</p>
                            ${(p.color || p.size) ? `<p class="text-xs text-gray-500">${p.color || ''} ${p.size || ''}</p>` : ''}
                            ${p.needPhoto ? `<p class="text-xs text-amber-600">–ù—É–∂–Ω–æ —Ñ–æ—Ç–æ —Å–æ —Å–∫–ª–∞–¥–∞</p>` : ''}
                            <div class="mt-2 grid grid-cols-2 sm:flex sm:flex-wrap gap-2">
                                ${p.warehousePhoto ? `<button type="button" onclick="openPhotoModal('${p.warehousePhoto}')" class="inline-block w-20 h-20 sm:w-16 sm:h-16 border rounded overflow-hidden bg-gray-50"><img src="${p.warehousePhoto}" alt="–§–æ—Ç–æ —Å–æ —Å–∫–ª–∞–¥–∞" class="w-full h-full object-cover"></button>` : ''}
                                ${p.productPhoto ? `<button type="button" onclick="openPhotoModal('${p.productPhoto}')" class="inline-block w-20 h-20 sm:w-16 sm:h-16 border rounded overflow-hidden bg-gray-50"><img src="${p.productPhoto}" alt="–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞" class="w-full h-full object-cover"></button>` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');

                const deliveryInfo = o.deliveryMethod ? `<div class="mt-2 text-sm text-gray-700">üöö ${o.deliveryMethod}${o.deliveryDetails ? ' ‚Äî ' + Object.values(o.deliveryDetails).filter(Boolean).join(', ') : ''}</div>` : '';

                const deliveryCosts = `
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 text-sm mt-2">
                        <span class="bg-gray-50 border rounded px-3 py-2">–°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤: <strong>${o.totalSum.toFixed(2)} BYN</strong></span>
                        <span class="bg-blue-50 border border-blue-100 rounded px-3 py-2">–î–æ—Å—Ç–∞–≤–∫–∞: <strong>${o.deliveryCost!=null ? Number(o.deliveryCost).toFixed(2) : '‚Äî'} BYN</strong></span>
                        <span class="bg-green-50 border border-green-100 rounded px-3 py-2">–ö –æ–ø–ª–∞—Ç–µ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É: <strong>${o.totalToPay!=null ? Number(o.totalToPay).toFixed(2) : '‚Äî'} BYN</strong></span>
                    </div>`;

                const receiptsBlock = `
                    <div class="mt-3 space-y-2">
                        <div class="flex items-center justify_between gap-2 text-sm bg-gray-50 border rounded px-3 py-2">
                            <div>
                                <p class="font-semibold text-gray-800">–ß–µ–∫ –æ–ø–ª–∞—Ç—ã —Ç–æ–≤–∞—Ä–∞</p>
                                <p class="text-xs text-gray-500">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —á–µ–∫, –µ—Å–ª–∏ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏</p>
                            </div>
                            <div class="flex items-center gap-2">
                                ${o.receipt ? `<button type=\"button\" onclick=\"openPhotoModal('${o.receipt}')\" class=\"text-purple-600 text-xs underline\">–û—Ç–∫—Ä—ã—Ç—å</button>` : ''}
                                <label class="text-xs text-blue-600 underline cursor-pointer">
                                    ${o.receipt ? '–ó–∞–º–µ–Ω–∏—Ç—å —á–µ–∫' : '–ó–∞–≥—Ä—É–∑–∏—Ç—å —á–µ–∫'}
                                    <input type="file" accept="image/*" class="hidden" onchange="handleReceiptUpload('${o.id}','goods',this)">
                                </label>
                            </div>
                        </div>
                        <div class="flex items-center justify-between gap-2 text-sm bg-gray-50 border rounded px-3 py-2">
                            <div>
                                <p class="font-semibold text-gray-800">–ß–µ–∫ –æ–ø–ª–∞—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏</p>
                                <p class="text-xs text-gray-500">–ü–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ —Ä–∞—Å—á—ë—Ç–∞ –≤–µ—Å–∞</p>
                            </div>
                            <div class="flex items-center gap-2">
                                ${o.deliveryReceipt ? `<button type=\"button\" onclick=\"openPhotoModal('${o.deliveryReceipt}')\" class=\"text-purple-600 text-xs underline\">–û—Ç–∫—Ä—ã—Ç—å</button>` : ''}
                                <label class="text-xs text-blue-600 underline cursor-pointer">
                                    ${o.deliveryReceipt ? '–ó–∞–º–µ–Ω–∏—Ç—å —á–µ–∫' : '–ó–∞–≥—Ä—É–∑–∏—Ç—å —á–µ–∫'}
                                    <input type="file" accept="image/*" class="hidden" onchange="handleReceiptUpload('${o.id}','delivery',this)">
                                </label>
                            </div>
                        </div>
                    </div>`;

                const card = document.createElement('div');
                card.className = 'rounded-2xl border border-gray-100 bg-white p-4 shadow space-y-2';
                card.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-xs text-gray-500">–ó–∞–∫–∞–∑</p>
                            <p class="text-lg font-bold">${o.id}</p>
                            <p class="text-[11px] text-gray-400 mt-1">${new Date(o.createdAt).toLocaleString()}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm bg-purple-100 text-purple-700">${o.status}</span>
                    </div>
                    ${deliveryInfo}
                    ${deliveryCosts}
                    <div class="mt-2 text-sm text-gray-800">–¢–æ–≤–∞—Ä—ã:</div>
                    <div>${productsHtml || '<p class="text-xs text-gray-500">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</p>'}</div>
                    ${receiptsBlock}
                `;
                list.appendChild(card);
            });
        }

        /* =============================
           LOCAL FALLBACK SAVERS
        ==============================*/
        function saveUsers() { localStorage.setItem('users', JSON.stringify(users)); }
        function saveOrders() { localStorage.setItem('orders', JSON.stringify(orders)); }
        function saveSettings() { localStorage.setItem('settings', JSON.stringify(settings)); }

        /* =============================
           ADMIN PANEL NAVIGATION
        ==============================*/
        async function showAdminPanel() {
            hideAllViews();
            await initData();
            document.getElementById('adminView').classList.remove('hidden');
            loadAdminSettings();
            loadAdminOrders();
            loadAdminUsers();
            updateStatistics();
        }

        function showAdminTab(tab) {
            const tabs = ['orders','finance','users','settings'];
            tabs.forEach(t => {
                document.getElementById(`admin${t.charAt(0).toUpperCase()+t.slice(1)}Tab`).classList.add('hidden');
                document.getElementById(`tab${t.charAt(0).toUpperCase()+t.slice(1)}`).classList.remove('bg-white','text-purple-900','shadow-lg','transform','scale-105');
                document.getElementById(`tab${t.charAt(0).toUpperCase()+t.slice(1)}`).classList.add('bg-white/10','text-white');
            });
            document.getElementById(`admin${tab.charAt(0).toUpperCase()+tab.slice(1)}Tab`).classList.remove('hidden');
            const btn = document.getElementById(`tab${tab.charAt(0).toUpperCase()+tab.slice(1)}`);
            btn.classList.add('bg-white','text-purple-900','shadow-lg','transform','scale-105');
            btn.classList.remove('bg-white/10','text-white');
        }

        function toggleCurrentMonth() {
            const checked = document.getElementById('filterCurrentMonth').checked;
            if (checked) {
                const now = new Date();
                document.getElementById('filterYear').value = String(now.getFullYear());
                document.getElementById('filterMonth').value = String(now.getMonth());
            } else {
                document.getElementById('filterMonth').value = 'all';
            }
            loadAdminOrders();
        }

        /* =============================
           ADMIN SETTINGS (UI)
        ==============================*/
        function loadAdminSettings() {
            document.getElementById('yuanRate').value = settings.yuanRate;
            document.getElementById('kgPrice').value = settings.kgPrice;
            document.getElementById('costYuan').value = settings.costYuan;
            document.getElementById('costKg').value = settings.costKg;
            document.getElementById('taxPercent').value = settings.taxPercent;
            document.getElementById('paymentDetails').value = settings.paymentDetails || '';
            const forbList = document.getElementById('forbiddenItemsAdminList');
            forbList.innerHTML = '';
            settings.forbiddenItems.forEach((item, idx) => {
                const row = document.createElement('div');
                row.className = 'flex items-center justify-between bg-red-50 border border-red-100 px-3 py-2 rounded-lg';
                row.innerHTML = `<span class="text-sm text-red-700">${item}</span><button class="text-xs text-red-600 hover:text-red-800" onclick="removeForbiddenItem(${idx})">–£–¥–∞–ª–∏—Ç—å</button>`;
                forbList.appendChild(row);
            });
            const delList = document.getElementById('deliveryMethodsList');
            delList.innerHTML = '';
            settings.deliveryMethods.forEach((m, idx) => {
                const row = document.createElement('div');
                row.className = 'flex items-center justify-between bg-green-50 border border-green-100 px-3 py-2 rounded-lg';
                row.innerHTML = `<span class="text-sm text-green-700">${m}</span><button class="text-xs text-green-600 hover:text-green-800" onclick="removeDeliveryMethod(${idx})">–£–¥–∞–ª–∏—Ç—å</button>`;
                delList.appendChild(row);
            });
        }

        async function saveRates() {
            settings.yuanRate = Number(document.getElementById('yuanRate').value || 0);
            settings.kgPrice = Number(document.getElementById('kgPrice').value || 0);
            settings.costYuan = Number(document.getElementById('costYuan').value || 0);
            settings.costKg = Number(document.getElementById('costKg').value || 0);
            settings.taxPercent = Number(document.getElementById('taxPercent').value || 0);
            await persistSettings();
            await fetchSettings();
            loadAdminSettings();
            showToast('–†–∞—Å—Ü–µ–Ω–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã','success');
        }
        async function savePaymentDetails() {
            settings.paymentDetails = document.getElementById('paymentDetails').value || '';
            await persistSettings();
            await fetchSettings();
            loadAdminSettings();
            showToast('–†–µ–∫–≤–∏–∑–∏—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã','success');
        }
        async function addForbiddenItem() {
            const val = document.getElementById('newForbiddenItem').value.trim();
            if (!val) return;
            settings.forbiddenItems.push(val);
            document.getElementById('newForbiddenItem').value='';
            await persistSettings();
            await fetchSettings();
            loadAdminSettings();
        }
        async function removeForbiddenItem(idx){
            settings.forbiddenItems.splice(idx,1);
            await persistSettings();
            await fetchSettings();
            loadAdminSettings();
        }
        async function addDeliveryMethod() {
            const val = document.getElementById('newDeliveryMethod').value.trim();
            if (!val) return;
            settings.deliveryMethods.push(val);
            document.getElementById('newDeliveryMethod').value='';
            await persistSettings();
            await fetchSettings();
            loadAdminSettings();
        }
        async function removeDeliveryMethod(idx){
            settings.deliveryMethods.splice(idx,1);
            await persistSettings();
            await fetchSettings();
            loadAdminSettings();
        }

        /* =============================
           ADMIN ORDERS LIST
        ==============================*/
        function loadAdminOrders() {
            const year = document.getElementById('filterYear').value;
            const month = document.getElementById('filterMonth').value;
            const sortStatus = document.getElementById('sortByStatus').checked;
            let filtered = [...orders];
            filtered = filtered.filter(o => {
                const d = new Date(o.createdAt);
                if (String(d.getFullYear()) !== String(year)) return false;
                if (month !== 'all' && d.getMonth() !== Number(month)) return false;
                return true;
            });
            if (sortStatus) {
                filtered.sort((a,b) => statusFlow.indexOf(a.status) - statusFlow.indexOf(b.status));
            } else {
                filtered.sort((a,b)=> new Date(b.createdAt)-new Date(a.createdAt));
            }
            const wrap = document.getElementById('adminOrders');
            wrap.innerHTML='';
            filtered.forEach(o => {
                const card = document.createElement('div');
                card.className='bg-white rounded-2xl shadow p-4 border border-gray-100';
                const productsHtml = o.products.map((p,i)=>`
                    <div class="flex items-start gap-3 border-b pb-2 mb-2">
                        <div class="text-gray-400 text-sm">${i+1}.</div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 flex-wrap">
                                <a href="${p.link}" target="_blank" class="text-purple-600 text-sm break-all">${p.link || '‚Äî'}</a>
                                ${p.trackingNumber ? `<span class='text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded'>–¢—Ä–µ–∫: ${p.trackingNumber}</span>`: ''}
                            </div>
                            <p class="text-xs text-gray-500">${p.quantity || 1} —à—Ç √ó ${p.price || 0} ¬•</p>
                            ${p.color||p.size ? `<p class='text-xs text-gray-500'>${p.color||''} ${p.size||''}</p>`:''}
                            ${p.needPhoto ? `<p class='text-xs text-amber-600'>–ù—É–∂–Ω–æ —Ñ–æ—Ç–æ —Å–æ —Å–∫–ª–∞–¥–∞</p>`:''}
                            <div class="mt-2 flex flex-wrap gap-2">
                                ${p.warehousePhoto ? `<button type="button" onclick="openPhotoModal('${p.warehousePhoto}')" class="inline-block w-16 h-16 border rounded overflow-hidden"><img src="${p.warehousePhoto}" alt="–§–æ—Ç–æ —Å–æ —Å–∫–ª–∞–¥–∞" class="w-full h-full object-cover"></button>` : ''}
                                ${p.productPhoto ? `<button type="button" onclick="openPhotoModal('${p.productPhoto}')" class="inline-block w-16 h-16 border rounded overflow-hidden"><img src="${p.productPhoto}" alt="–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞" class="w-full h-full object-cover"></button>` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
                const deliveryInfo = o.deliveryMethod ? `<div class="mt-2 text-sm text-gray-700">üöö ${o.deliveryMethod}${o.deliveryDetails ? ' ‚Äî '+Object.values(o.deliveryDetails).filter(Boolean).join(', ') : ''}</div>`: '';
                const statusSelect = `
                    <select onchange="changeOrderStatus('${o.id}', this.value)" class="px-3 py-1 rounded-lg border text-sm focus:ring-2 focus:ring-purple-500">
                        ${statusFlow.map(st=>`<option value="${st}" ${st===o.status?'selected':''}>${st}</option>`).join('')}
                    </select>`;
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <p class="text-xs text-gray-500">${new Date(o.createdAt).toLocaleString()}</p>
                            <h3 class="text-lg font-bold">${o.id}</h3>
                            <p class="text-sm text-gray-600">${o.userName || ''} (${o.userTelegram||''})</p>
                        </div>
                        <div class="flex items-center gap-2">
                            ${statusSelect}
                        </div>
                    </div>
                    ${deliveryInfo}
                    <div class="mt-3 text-sm text-gray-800">–¢–æ–≤–∞—Ä—ã:</div>
                    <div class="mt-1">${productsHtml || '<p class="text-xs text-gray-500">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</p>'}</div>
                    <div class="flex flex-wrap gap-2 mt-3 text-sm">
                        <span class="bg-gray-100 px-3 py-1 rounded">–°—É–º–º–∞: ${o.totalSum.toFixed(2)} BYN</span>
                        ${o.deliveryCost!=null ? `<span class="bg-blue-50 text-blue-700 px-3 py-1 rounded">–î–æ—Å—Ç–∞–≤–∫–∞: ${Number(o.deliveryCost).toFixed(2)} BYN</span>`:''}
                        ${o.totalToPay!=null ? `<span class="bg-green-50 text-green-700 px-3 py-1 rounded">–ö –æ–ø–ª–∞—Ç–µ: ${Number(o.totalToPay).toFixed(2)} BYN</span>`:''}
                    </div>
                    <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                        <div class="bg-gray-50 border rounded px-3 py-2 flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-800">–ß–µ–∫ –æ–ø–ª–∞—Ç—ã —Ç–æ–≤–∞—Ä–∞</p>
                                <p class="text-xs text-gray-500">–ó–∞–≥—Ä—É–∂–µ–Ω –∫–ª–∏–µ–Ω—Ç–æ–º</p>
                            </div>
                            <div class="flex items-center gap-2">
                                ${o.receipt ? `<button type="button" onclick="openPhotoModal('${o.receipt}')" class="text-purple-600 text-xs underline">–û—Ç–∫—Ä—ã—Ç—å</button>` : '<span class="text-xs text-gray-400">–Ω–µ—Ç</span>'}
                            </div>
                        </div>
                        <div class="bg-gray-50 border rounded px-3 py-2 flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-800">–ß–µ–∫ –æ–ø–ª–∞—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏</p>
                                <p class="text-xs text-gray-500">–ó–∞–≥—Ä—É–∂–µ–Ω –∫–ª–∏–µ–Ω—Ç–æ–º</p>
                            </div>
                            <div class="flex items-center gap-2">
                                ${o.deliveryReceipt ? `<button type="button" onclick="openPhotoModal('${o.deliveryReceipt}')" class="text-purple-600 text-xs underline">–û—Ç–∫—Ä—ã—Ç—å</button>` : '<span class="text-xs text-gray-400">–Ω–µ—Ç</span>'}
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-2 mt-4">
                        <button class="px-3 py-2 rounded-lg bg-indigo-50 text-indigo-700 text-sm" onclick="openWeightModal('${o.id}')">–í–≤–µ—Å—Ç–∏ –≤–µ—Å</button>
                        <button class="px-3 py-2 rounded-lg bg-amber-50 text-amber-700 text-sm" onclick="openEditOrder('${o.id}')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <label class="inline-flex items-center gap-2 text-sm"><input type="checkbox" class="order-select" value="${o.id}"> –í—ã–±—Ä–∞—Ç—å</label>
                        <button class="px-3 py-2 rounded-lg bg-gray-50 text-gray-700 text-sm" onclick="notifyClient('${o.id}')">üì¢ –£–≤–µ–¥–æ–º–∏—Ç—å</button>
                        <button class="px-3 py-2 rounded-lg bg-red-50 text-red-700 text-sm" onclick="removeOrder('${o.id}')">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `;
                wrap.appendChild(card);
            });
        }

        function removeOrder(id){
            if(!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑?')) return;
            deleteOrder(id).then(()=>{loadAdminOrders(); loadClientOrders(); updateStatistics();});
        }

        /* =============================
           ADMIN USERS LIST (pretty cards)
        ==============================*/
        function loadAdminUsers() {
            const wrap = document.getElementById('adminUsers');
            wrap.innerHTML='';

            // –µ—Å–ª–∏ –Ω–µ—Ç —è–≤–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ users –∏–∑ –ë–î, —Å–æ–±–∏—Ä–∞–µ–º –∏–∑ –∑–∞–∫–∞–∑–æ–≤
            const usersMap = {};
            if (Array.isArray(users) && users.length) {
                users.forEach(u => {
                    usersMap[u.id || u.phone] = {
                        name: u.fullName || '–ë–µ–∑ –∏–º–µ–Ω–∏',
                        phone: u.phone || '‚Äî',
                        tg: u.telegram || '‚Äî',
                        registeredAt: u.registeredAt || ''
                    };
                });
            } else {
                orders.forEach(o => {
                    if (!o.userId) return;
                    const phoneSafe = o.userPhone || o.userId || '‚Äî';
                    usersMap[o.userId] = {
                        name: o.userName || '–ë–µ–∑ –∏–º–µ–Ω–∏',
                        phone: phoneSafe,
                        tg: o.userTelegram || '‚Äî',
                        registeredAt: o.createdAt || ''
                    };
                });
            }

            const palette = ['from-indigo-500 to-purple-600','from-emerald-500 to-teal-600','from-orange-500 to-amber-600','from-blue-500 to-cyan-600','from-pink-500 to-rose-600'];

            Object.entries(usersMap).forEach(([key, u], idx) => {
                const initials = (u.name||'').split(' ').map(w=>w[0]||'').join('').slice(0,2).toUpperCase() || 'U';
                const grad = palette[idx % palette.length];
                const card = document.createElement('div');
                card.className='bg-white/90 backdrop-blur rounded-2xl border border-gray-100 p-4 shadow-md flex items-center gap-4 hover:-translate-y-1 hover:shadow-xl transition';
                card.innerHTML = `
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br ${grad} text-white flex items-center justify-center text-lg font-bold shadow-lg">${initials}</div>
                    <div class="flex-1 space-y-1">
                        <p class="font-semibold text-gray-900 text-sm">${u.name||'–ë–µ–∑ –∏–º–µ–Ω–∏'}</p>
                        <p class="text-xs text-gray-500">–¢–µ–ª–µ—Ñ–æ–Ω: ${u.phone||'‚Äî'}</p>
                        <p class="text-xs text-gray-500">Telegram: ${u.tg||'‚Äî'}</p>
                        ${u.registeredAt ? `<p class="text-[11px] text-gray-400">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${new Date(u.registeredAt).toLocaleString()}</p>` : ''}
                    </div>
                    <div class="px-3 py-1 text-xs rounded-full bg-gray-50 border text-gray-600">–ö–ª–∏–µ–Ω—Ç</div>
                `;
                wrap.appendChild(card);
            });
        }

        /* =============================
           EDIT ORDER
        ==============================*/
        function openEditOrder(id){
            currentEditOrderId = id;
            const order = orders.find(o=>o.id===id);
            if(!order) return;
            document.getElementById('editOrderId').textContent = id;
            const sel = document.getElementById('editDeliveryMethod');
            sel.innerHTML='';
            settings.deliveryMethods.forEach(m=>{
                const opt = document.createElement('option');
                opt.value=m; opt.textContent=m; if(m===order.deliveryMethod) opt.selected=true; sel.appendChild(opt);
            });
            document.getElementById('editEuropostBranch').value = order.deliveryDetails?.europostBranch||'';
            document.getElementById('editBelpostIndex').value = order.deliveryDetails?.index||'';
            document.getElementById('editBelpostCity').value = order.deliveryDetails?.city||'';
            document.getElementById('editBelpostStreet').value = order.deliveryDetails?.street||'';
            document.getElementById('editBelpostHouse').value = order.deliveryDetails?.house||'';
            handleEditDeliveryExtras();
            const cont = document.getElementById('editProductsContainer');
            cont.innerHTML='';
            order.products.forEach((p,idx)=>{
                const row = document.createElement('div');
                row.className='border rounded-lg p-3 bg-white';
                row.innerHTML=`
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-semibold">–¢–æ–≤–∞—Ä ${idx+1}</span>
                        <button type="button" class="text-red-500 text-sm" onclick="removeEditProductRow(this)">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                        <input class="edit-link px-3 py-2 border rounded" placeholder="–°—Å—ã–ª–∫–∞" value="${p.link||''}">
                        <input class="edit-price px-3 py-2 border rounded" type="number" step="0.01" value="${p.price||0}">
                        <input class="edit-qty px-3 py-2 border rounded" type="number" step="1" value="${p.quantity||1}">
                        <input class="edit-color px-3 py-2 border rounded" placeholder="–¶–≤–µ—Ç" value="${p.color||''}">
                        <input class="edit-size px-3 py-2 border rounded" placeholder="–†–∞–∑–º–µ—Ä" value="${p.size||''}">
                        <label class="inline-flex items-center gap-2 text-sm"><input type="checkbox" class="edit-needphoto" ${p.needPhoto?'checked':''}> –ù—É–∂–Ω–æ —Ñ–æ—Ç–æ</label>
                        <input class="edit-track px-3 py-2 border rounded" placeholder="–¢—Ä–µ–∫-–Ω–æ–º–µ—Ä" value="${p.trackingNumber||''}">
                        <textarea class="edit-comment px-3 py-2 border rounded md:col-span-2" rows="2" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">${p.comment||''}</textarea>
                    </div>`;
                cont.appendChild(row);
            });
            document.getElementById('editOrderModal').classList.remove('hidden');
        }

        function removeEditProductRow(btn){
            const row = btn.closest('.border');
            if(row) row.remove();
        }

        function handleEditDeliveryExtras(){
            const method = document.getElementById('editDeliveryMethod').value;
            const e1 = document.getElementById('editEuropostBlock');
            const e2 = document.getElementById('editBelpostBlock');
            e1.classList.add('hidden'); e2.classList.add('hidden');
            if (method==='–ï–≤—Ä–æ–ø–æ—á—Ç–∞') e1.classList.remove('hidden');
            if (method==='–ë–µ–ª–ø–æ—á—Ç–∞') e2.classList.remove('hidden');
        }

        async function saveEditOrder(){
            const order = orders.find(o=>o.id===currentEditOrderId);
            if(!order) return;
            order.deliveryMethod = document.getElementById('editDeliveryMethod').value;
            const dd = {};
            if(order.deliveryMethod==='–ï–≤—Ä–æ–ø–æ—á—Ç–∞') dd.europostBranch = document.getElementById('editEuropostBranch').value;
            if(order.deliveryMethod==='–ë–µ–ª–ø–æ—á—Ç–∞') {
                dd.index = document.getElementById('editBelpostIndex').value;
                dd.city = document.getElementById('editBelpostCity').value;
                dd.street = document.getElementById('editBelpostStreet').value;
                dd.house = document.getElementById('editBelpostHouse').value;
            }
            order.deliveryDetails = dd;
            const rows = document.querySelectorAll('#editProductsContainer .border');
            const prods = [];
            rows.forEach(r=>{
                prods.push({
                    link: r.querySelector('.edit-link').value,
                    price: Number(r.querySelector('.edit-price').value||0),
                    quantity: Number(r.querySelector('.edit-qty').value||1),
                    color: r.querySelector('.edit-color').value,
                    size: r.querySelector('.edit-size').value,
                    needPhoto: r.querySelector('.edit-needphoto').checked,
                    trackingNumber: r.querySelector('.edit-track').value,
                    comment: r.querySelector('.edit-comment').value
                });
            });
            order.products = prods;
            // –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å—É–º–º—É –∑–∞–∫–∞–∑–∞
            const rate = Number(settings.yuanRate||0);
            order.totalSum = prods.reduce((s,p)=> s + (Number(p.price||0)*Number(p.quantity||0)*rate),0);
            await persistOrder(order);
            saveOrders();
            loadAdminOrders();
            loadClientOrders();
            updateStatistics();
            closeEditOrder();
            showToast('–ó–∞–∫–∞–∑ –æ–±–Ω–æ–≤–ª–µ–Ω','success');
        }
        function closeEditOrder(){
            const m=document.getElementById('editOrderModal'); if(m) m.classList.add('hidden');
        }

        /* =============================
           WEIGHT MODAL / DELIVERY COST
        ==============================*/
        function openWeightModal(id){
            currentWeightOrderId = id;
            const order = orders.find(o=>o.id===id);
            if(!order) return;
            document.getElementById('weightOrderId').textContent = id;
            const cont = document.getElementById('weightProductsContainer');
            cont.innerHTML='';
            order.products.forEach((p,idx)=>{
                const row = document.createElement('div');
                row.className='border rounded-lg p-3 bg-white';
                row.innerHTML=`
                    <p class="text-sm font-semibold mb-2">–¢–æ–≤–∞—Ä ${idx+1}</p>
                    <p class="text-xs text-gray-500 break-all mb-2">${p.link||''}</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mb-2">
                        <input type="number" step="0.01" class="w-full px-3 py-2 border rounded weight-input" placeholder="–í–µ—Å, –∫–≥" value="${p.weight||''}">
                        <input type="text" class="w-full px-3 py-2 border rounded track-input" placeholder="–¢—Ä–µ–∫-–Ω–æ–º–µ—Ä" value="${p.trackingNumber||''}">
                        <input type="file" accept="image/*" class="w-full px-3 py-1 border rounded warehouse-photo-input" ${p.needPhoto ? '' : 'hidden'}>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                        <div class="text-xs text-gray-500 md:col-span-3">${p.needPhoto ? '–§–æ—Ç–æ —Å–æ —Å–∫–ª–∞–¥–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Ñ–æ—Ç–æ)' : '–§–æ—Ç–æ —Å–æ —Å–∫–ª–∞–¥–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è'}</div>
                        <div class="md:col-span-3 flex flex-wrap gap-2 items-center">
                            ${p.warehousePhoto ? `<a href="${p.warehousePhoto}" target="_blank" class="text-xs text-blue-600 underline">–§–æ—Ç–æ —Å–æ —Å–∫–ª–∞–¥–∞ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ (–æ–±–Ω–æ–≤–∏—Ç—å –º–æ–∂–Ω–æ –Ω–∏–∂–µ)</a>` : ''}
                        </div>
                        <label class="text-sm font-medium md:col-span-3">–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <input type="file" accept="image/*" class="w-full px-3 py-1 border rounded product-photo-input md:col-span-3">
                        ${p.productPhoto ? `<div class="md:col-span-3 text-xs text-blue-600">–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ‚Äî –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å.</div>` : ''}
                    </div>
                `;
                cont.appendChild(row);
            });
            document.getElementById('weightModal').classList.remove('hidden');
        }
        function closeWeightModal(){ const m=document.getElementById('weightModal'); if(m) m.classList.add('hidden'); }

        async function changeOrderStatus(orderId, newStatus){
            const order = orders.find(o=>o.id===orderId);
            if(!order) return;
            order.status = newStatus;
            await persistOrder(order);
            loadAdminOrders();
            loadClientOrders();
            updateStatistics();
            showToast('–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—ë–Ω','success');
        }

        async function saveWeightData(){
            const order = orders.find(o=>o.id===currentWeightOrderId);
            if(!order) return;
            const rows = document.querySelectorAll('#weightProductsContainer .border');
            let totalWeight = 0;
            const prods = order.products.map((p,idx)=>{
                const row = rows[idx];
                const w = Number(row.querySelector('.weight-input').value||0);
                const track = row.querySelector('.track-input').value;
                const fileWarehouse = row.querySelector('.warehouse-photo-input')?.files?.[0];
                const fileProduct = row.querySelector('.product-photo-input')?.files?.[0];
                totalWeight += w;
                return {
                    ...p,
                    weight: w,
                    trackingNumber: track,
                    warehousePhoto: p.warehousePhoto || null,
                    productPhoto: p.productPhoto || null,
                    _fileWarehouse: fileWarehouse,
                    _fileProduct: fileProduct
                };
            });
            // –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
            for (let i=0;i<prods.length;i++){
                if (prods[i]._fileWarehouse){
                    prods[i].warehousePhoto = await fileToBase64(prods[i]._fileWarehouse);
                }
                if (prods[i]._fileProduct){
                    prods[i].productPhoto = await fileToBase64(prods[i]._fileProduct);
                }
                delete prods[i]._fileWarehouse;
                delete prods[i]._fileProduct;
            }
            order.products = prods;
            order.totalWeight = totalWeight;
            order.deliveryCost = Number(totalWeight * (settings.kgPrice||0));
            order.totalToPay = order.deliveryCost;
            await persistOrder(order);
            loadAdminOrders();
            loadClientOrders();
            updateStatistics();
            closeWeightModal();
            showToast('–î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã','success');
        }

        /* =============================
           CLIENT SEARCH
        ==============================*/
        function searchClientOrders(){
            clientSearchTerm = document.getElementById('searchOrder').value || '';
            loadClientOrders();
        }

        /* =============================
           FINANCE / STATS (simple)
        ==============================*/
        function calcProfitData(filterFn){
            const rate = Number(settings.yuanRate||0);
            const costY = Number(settings.costYuan||0);
            const costK = Number(settings.costKg||0);
            const taxP = Number(settings.taxPercent||0)/100;
            let revenueGoods=0, costGoods=0, revenueDel=0, costDel=0, paidSum=0, totalOrders=0, paidOrders=0;
            orders.filter(filterFn).forEach(o=>{
                totalOrders++;
                if (['–û–ø–ª–∞—á–µ–Ω','–í—ã–∫—É–ø–ª–µ–Ω','–û—Ç–ø—Ä–∞–≤–ª–µ–Ω –∏–∑ –ö–∏—Ç–∞—è','–ü—Ä–∏–±—ã–ª –≤ –ú–æ—Å–∫–≤—É','–î–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –ë–µ–ª–∞—Ä—É—Å—å','–î–æ—Å—Ç–∞–≤–ª–µ–Ω'].includes(o.status)) paidOrders++;
                if (o.status!=='–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã') paidSum += Number(o.totalSum||0);
                o.products.forEach(p=>{
                    revenueGoods += Number(p.price||0)*Number(p.quantity||0)*rate;
                    costGoods += Number(p.price||0)*Number(p.quantity||0)*costY;
                });
                revenueDel += Number(o.deliveryCost||0);
                costDel += Number(o.totalWeight||0)*costK;
            });
            const taxGoods = revenueGoods * taxP;
            const taxDel = revenueDel * taxP;
            const netGoods = revenueGoods - taxGoods - costGoods;
            const netDel = revenueDel - taxDel - costDel;
            return {
                revenueGoods,costGoods,taxGoods,netGoods,
                revenueDel,costDel,taxDel,netDel,
                totalNet: netGoods+netDel,
                totalTax: taxGoods+taxDel,
                totalOrders,paidOrders,paidSum
            };
        }

        function updateFinanceSummaryCurrentMonth(){
            const now = new Date();
            const filter = (o)=>{
                const d=new Date(o.createdAt);
                return d.getFullYear()===now.getFullYear() && d.getMonth()===now.getMonth();
            };
            const data = calcProfitData(filter);
            const setText = (id,val)=>{const el=document.getElementById(id); if(el) el.textContent=val;};
            setText('calcTotalNetProfitFinal', `${data.totalNet.toFixed(2)} BYN`);
            setText('calcTotalTax', `${data.totalTax.toFixed(2)} BYN`);
            setText('calcTotalPaidOrders', `${data.paidSum.toFixed(2)} BYN`);
            setText('calcProfitGoods', data.revenueGoods.toFixed(2));
            setText('calcCostGoods', data.costGoods.toFixed(2));
            setText('calcTaxGoods', data.taxGoods.toFixed(2));
            setText('calcNetProfitGoods', data.netGoods.toFixed(2));
            setText('calcProfitDelivery', data.revenueDel.toFixed(2));
            setText('calcCostDelivery', data.costDel.toFixed(2));
            setText('calcTaxDelivery', data.taxDel.toFixed(2));
            setText('calcNetProfitDelivery', data.netDel.toFixed(2));
            setText('calcTotalNetProfit', data.totalNet.toFixed(2));
        }

        function updateStatistics(){
            const year = document.getElementById('statsYear').value;
            const month = document.getElementById('statsMonth').value;
            const type = document.getElementById('statsType').value;

            const summaryBlock = document.getElementById('summaryStats');
            const monthlyBlock = document.getElementById('monthlyStats');
            const yearlyBlock = document.getElementById('yearlyStats');
            summaryBlock.classList.add('hidden');
            monthlyBlock.classList.add('hidden');
            yearlyBlock.classList.add('hidden');

            const filter = (o)=>{
                const d=new Date(o.createdAt);
                if(String(d.getFullYear())!==String(year)) return false;
                if(month!=='all' && d.getMonth()!==Number(month)) return false;
                return true;
            };
            const data = calcProfitData(filter);
            // summary
            document.getElementById('statsProfitGoods').textContent = data.netGoods.toFixed(2)+' BYN';
            document.getElementById('statsProfitDelivery').textContent = data.netDel.toFixed(2)+' BYN';
            document.getElementById('statsTotalProfit').textContent = data.totalNet.toFixed(2)+' BYN';
            document.getElementById('statsTotalTax').textContent = data.totalTax.toFixed(2)+' BYN';
            document.getElementById('statsTotalOrders').textContent = data.totalOrders;
            document.getElementById('statsPaidOrders').textContent = data.paidOrders;
            document.getElementById('statsPaidSum').textContent = data.paidSum.toFixed(2)+' BYN';

            if(type==='summary'){
                summaryBlock.classList.remove('hidden');
            }
            if(type==='monthly'){
                monthlyBlock.classList.remove('hidden');
                const cont = document.getElementById('monthlyStatsContent');
                cont.innerHTML='';
                for(let m=0;m<12;m++){
                    const mf = orders.filter(o=>{
                        const d=new Date(o.createdAt);
                        return d.getFullYear()===Number(year) && d.getMonth()===m;
                    });
                    if(!mf.length) continue;
                    const ddata = calcProfitData(o=>{
                        const d=new Date(o.createdAt);
                        return d.getFullYear()===Number(year) && d.getMonth()===m;
                    });
                    const row=document.createElement('div');
                    row.className='flex justify-between bg-gray-50 border rounded px-3 py-2 text-sm';
                    row.innerHTML=`<span>${['–Ø–Ω–≤','–§–µ–≤','–ú–∞—Ä','–ê–ø—Ä','–ú–∞–π','–ò—é–Ω','–ò—é–ª','–ê–≤–≥','–°–µ–Ω','–û–∫—Ç','–ù–æ—è','–î–µ–∫'][m]}</span><span class="font-semibold">${ddata.totalNet.toFixed(2)} BYN</span>`;
                    cont.appendChild(row);
                }
            }
            if(type==='yearly'){
                yearlyBlock.classList.remove('hidden');
                const yearsMap={};
                orders.forEach(o=>{
                    const y=new Date(o.createdAt).getFullYear();
                    yearsMap[y]=yearsMap[y]||[];
                    yearsMap[y].push(o);
                });
                const cont=document.getElementById('yearlyStatsContent');
                cont.innerHTML='';
                Object.keys(yearsMap).sort().forEach(y=>{
                    const ddata = calcProfitData(o=> new Date(o.createdAt).getFullYear()===Number(y));
                    const row=document.createElement('div');
                    row.className='flex justify-between bg-gray-50 border rounded px-3 py-2 text-sm';
                    row.innerHTML=`<span>${y}</span><span class="font-semibold">${ddata.totalNet.toFixed(2)} BYN</span>`;
                    cont.appendChild(row);
                });
            }

            // –æ–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ä—Ö–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            updateFinanceSummaryCurrentMonth();
        }

        /* =============================
           EXPORT CSV (ADMIN)
        ==============================*/
        function exportSelectedOrders(){
            const selected = Array.from(document.querySelectorAll('.order-select:checked')).map(cb=>cb.value);
            if (!selected.length) return showToast('–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑—ã –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞','warning');
            const rows = [];
            selected.forEach(id=>{
                const o = orders.find(x=>x.id===id);
                if(!o) return;
                o.products.forEach((p,idx)=>{
                    rows.push({
                        'ID –∑–∞–∫–∞–∑–∞': o.id,
                        '–°–æ–∑–¥–∞–Ω': new Date(o.createdAt).toLocaleString(),
                        '–°—Ç–∞—Ç—É—Å': o.status,
                        '–ö–ª–∏–µ–Ω—Ç': o.userName,
                        '–¢–µ–ª–µ—Ñ–æ–Ω': o.userPhone || o.userId,
                        'Telegram': o.userTelegram,
                        '–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏': o.deliveryMethod,
                        '–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏': Object.values(o.deliveryDetails||{}).filter(Boolean).join(', '),
                        '–¢–æ–≤–∞—Ä #': idx+1,
                        '–°—Å—ã–ª–∫–∞': p.link,
                        '–¶–µ–Ω–∞ ¬•': p.price,
                        '–ö–æ–ª-–≤–æ': p.quantity,
                        '–¶–≤–µ—Ç': p.color,
                        '–†–∞–∑–º–µ—Ä': p.size,
                        '–ù—É–∂–Ω–æ —Ñ–æ—Ç–æ': p.needPhoto ? '–î–∞':'–ù–µ—Ç',
                        '–¢—Ä–µ–∫-–Ω–æ–º–µ—Ä': p.trackingNumber||'',
                        '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π': p.comment||'',
                        '–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ BYN': o.totalSum,
                        '–î–æ—Å—Ç–∞–≤–∫–∞ BYN': o.deliveryCost||'',
                        '–ö –æ–ø–ª–∞—Ç–µ BYN': o.totalToPay||''
                    });
                });
            });
            if(!rows.length) return showToast('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞','warning');
            const headers = Object.keys(rows[0]);
            const csv = [headers.join(',')].concat(rows.map(r=>headers.map(h=>`"${String(r[h]??'').replace(/"/g,'""')}"`).join(','))).join('\n');
            const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `orders_export_${new Date().toISOString().slice(0,10)}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast('–≠–∫—Å–ø–æ—Ä—Ç –≥–æ—Ç–æ–≤','success');
        }

        /* =============================
           ADMIN NOTIFY (Telegram helper)
        ==============================*/
        function openTelegramChat(username) {
            if (!username) {
                showToast('–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —É–∫–∞–∑–∞–Ω Telegram', 'warning');
                return;
            }
            const tg = username.startsWith('@') ? username.slice(1) : username;
            const url = `https://t.me/${tg}`;
            window.open(url, '_blank');
        }

        function notifyClient(orderId){
            const o = orders.find(x=>x.id===orderId);
            if(!o) return;

            // –®–∞–±–ª–æ–Ω—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É
            let msg = `üá®üá≥ –ò–∑ –ö–∏—Ç–∞—è —Å –ª—é–±–æ–≤—å—é\n\nüì¶ –ó–∞–∫–∞–∑ #${o.id}\n`;
            switch (o.status) {
                case '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã':
                    msg += `–°—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã\nüí∞ –°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤: ${Number(o.totalSum||0).toFixed(2)} BYN\n\n–†–µ–∫–≤–∏–∑–∏—Ç—ã –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ.`;
                    break;
                case '–û–ø–ª–∞—á–µ–Ω':
                    msg += `–°—Ç–∞—Ç—É—Å: –û–ø–ª–∞—á–µ–Ω\nüí∞ –°—É–º–º–∞: ${Number(o.totalSum||0).toFixed(2)} BYN\n\n–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–ø–ª–∞—Ç—É! –°–∫–æ—Ä–æ –≤—ã–∫—É–ø–∏–º –∑–∞–∫–∞–∑.`;
                    break;
                case '–í—ã–∫—É–ø–ª–µ–Ω':
                    msg += `–°—Ç–∞—Ç—É—Å: –í—ã–∫—É–ø–ª–µ–Ω\n\n–û–∂–∏–¥–∞–µ–º –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –Ω–∞ —Å–∫–ª–∞–¥ –≤ –ö–∏—Ç–∞–µ.`;
                    break;
                case '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω –∏–∑ –ö–∏—Ç–∞—è':
                    msg += `–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∏–∑ –ö–∏—Ç–∞—è!\n`;
                    if (o.totalWeight) msg += `‚öñÔ∏è –í–µ—Å: ${o.totalWeight} –∫–≥\n`;
                    if (o.totalToPay!=null) msg += `üí∞ –ö –æ–ø–ª–∞—Ç–µ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É: ${Number(o.totalToPay).toFixed(2)} BYN\n`;
                    msg += `\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —á–µ–∫ –æ–ø–ª–∞—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ.`;
                    break;
                case '–ü—Ä–∏–±—ã–ª –≤ –ú–æ—Å–∫–≤—É':
                    msg += `–°—Ç–∞—Ç—É—Å: –ü—Ä–∏–±—ã–ª –≤ –ú–æ—Å–∫–≤—É\n\n–ì–æ—Ç–æ–≤–∏—Ç—Å—è –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ –ë–µ–ª–∞—Ä—É—Å—å.`;
                    break;
                case '–î–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –ë–µ–ª–∞—Ä—É—Å—å':
                    msg += `–°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –ë–µ–ª–∞—Ä—É—Å—å\n\n–ú—ã —Å–æ–æ–±—â–∏–º, –∫–æ–≥–¥–∞ –∑–∞–∫–∞–∑ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ.`;
                    break;
                case '–î–æ—Å—Ç–∞–≤–ª–µ–Ω':
                    msg += `–°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∞–≤–ª–µ–Ω\n\n–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –≤—ã–±—Ä–∞–ª–∏ –Ω–∞—Å!`;
                    break;
                default:
                    msg += `–°—Ç–∞—Ç—É—Å: ${o.status}\n\n–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑!`;
            }

            copyTextToClipboard(msg);
            openTelegramChat(o.userTelegram);
            showToast('–°–æ–æ–±—â–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ. –í—Å—Ç–∞–≤—å—Ç–µ –≤ Telegram –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–ª–∏–µ–Ω—Ç—É.', 'info');
        }

        function copyTextToClipboard(text){
            if(navigator.clipboard){ navigator.clipboard.writeText(text); return; }
            const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        }

        /* =============================
           INIT DEFAULT TAB
        ==============================*/
        showAdminTab('orders');

    </script>
</body>
</html>
